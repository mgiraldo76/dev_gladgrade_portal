"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{5800:function(e,l,n){n.d(l,{Providers:function(){return g},a:function(){return c}});var t=n(7437),a=n(2265),s=n(3301),i=n(5516),o=n(5922);function r(e){let{children:l,...n}=e;return(0,t.jsx)(o.f,{...n,children:l})}let d=(0,a.createContext)({user:null,role:null,clientRole:null,businessId:null,loading:!0,isFirebaseConfigured:!1}),c=()=>(0,a.useContext)(d);function u(e){if(console.log("\uD83D\uDD0D Determining role for email:",e),!e)return console.log("❌ No email provided, defaulting to client"),"client";let l=e.toLowerCase();return"miguel.giraldo@gladgrade.com"===l?(console.log("\uD83D\uDC51 Super Admin detected!"),"super_admin"):l.endsWith("@gladgrade.com")?(console.log("\uD83C\uDFE2 GladGrade employee detected"),l.includes("admin"))?(console.log("\uD83D\uDEE1️ Admin role assigned"),"admin"):l.includes("moderator")||l.includes("mod")?(console.log("\uD83D\uDD0D Moderator role assigned"),"moderator"):l.includes("support")||l.includes("employee")?(console.log("\uD83D\uDC64 Employee role assigned"),"employee"):(console.log("\uD83D\uDEE1️ Default admin role for GladGrade employee"),"admin"):(console.log("\uD83C\uDFEA Client role assigned"),"client")}function m(e){let{children:l}=e,[n,o]=(0,a.useState)(null),[r,c]=(0,a.useState)(null),[m,g]=(0,a.useState)(null),[f,x]=(0,a.useState)(null),[h,p]=(0,a.useState)(!0),[w,D]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(console.log("\uD83D\uDE80 AuthProvider useEffect running..."),console.log("\uD83D\uDD27 Firebase configured:",!0),D(!0),i.I8){console.log("\uD83D\uDD10 Setting up Firebase auth listener...");let e=(0,s.Aj)(i.I8,async e=>{if(console.log("\uD83D\uDD04 Auth state changed:",e?"User: ".concat(e.email):"No user"),o(e),e&&e.email)try{console.log("\uD83C\uDFAF Getting user role...");let l=await e.getIdTokenResult(),n=l.claims.role,t=null,a=null;console.log("\uD83C\uDFF7️ Custom claim role:",n),"client"===n&&l.claims.businessId&&(t=parseInt(l.claims.businessId),console.log("\uD83C\uDFE2 Client businessId extracted:",t),l.claims.user_role&&(a=l.claims.user_role,console.log("\uD83D\uDC64 Client role extracted:",a))),n||(n=u(e.email),console.log("\uD83D\uDD10 Role assigned based on email domain: ".concat(e.email," → ").concat(n))),c(n),g(a),x(t),console.log("✅ Final role set:",n),console.log("✅ Final clientRole set:",a),console.log("✅ Final businessId set:",t)}catch(n){console.error("❌ Error getting user role:",n);let l=u(e.email);c(l),g(null),x(null),console.log("\uD83D\uDD04 Fallback role assigned: ".concat(e.email," → ").concat(l))}else console.log("\uD83D\uDC64 No user, setting role and businessId to null"),c(null),g(null),x(null);console.log("⏰ Setting loading to false"),p(!1)});return()=>{console.log("\uD83E\uDDF9 Cleaning up auth listener"),e()}}console.log("❌ Firebase not configured or auth not available"),p(!1)},[]),(0,t.jsx)(d.Provider,{value:{user:n,role:r,clientRole:m,businessId:f,loading:h,isFirebaseConfigured:w},children:l})}function g(e){let{children:l}=e;return(0,t.jsx)(r,{attribute:"class",defaultTheme:"light",enableSystem:!0,disableTransitionOnChange:!1,children:(0,t.jsx)(m,{children:l})})}},724:function(e,l,n){n.d(l,{W:function(){return y}});var t=n(7437),a=n(2265),s=n(6110),i=n(2869),o=n(5974),r=n(6070),d=n(7404),c=n(44),u=n(3774),m=n(1671),g=n(8867),f=n(6362),x=n(2735),h=n(1817),p=n(9345),w=n(7625),D=n(5800),b=n(7855);function y(e){let{isOpen:l,onClose:n,businessId:y,businessName:v,placeId:C,businessAddress:j}=e,{user:R}=(0,D.a)(),[N,S]=(0,a.useState)(null),[k,A]=(0,a.useState)(!1),[E,G]=(0,a.useState)(null),[I,F]=(0,a.useState)(!1),[U,L]=(0,a.useState)(!0),[T,z]=(0,a.useState)(!1),[Q,q]=(0,a.useState)(!1),[_,Z]=(0,a.useState)(null);(0,a.useEffect)(()=>{l&&y&&(O(),q(!1),Z(null))},[l,y]);let O=async()=>{A(!0),G(null);try{console.log("\uD83D\uDD04 Generating QR code for business ".concat(y," via apiClient..."));let e=await b.x.generateClientQRCode(y);if(e.success)S(e.data),console.log("✅ QR code generated successfully via apiClient");else throw Error(e.error||"Failed to generate QR code")}catch(e){console.error("❌ Error generating QR code via apiClient:",e),G(e instanceof Error?e.message:"Unknown error")}finally{A(!1)}},P=async()=>{if(null==N?void 0:N.qrUrl)try{await navigator.clipboard.writeText(N.qrUrl),F(!0),setTimeout(()=>F(!1),2e3)}catch(e){console.error("Failed to copy URL:",e)}},B=async()=>{if(!N){Z("QR code not generated yet");return}z(!0),Z(null),q(!1);try{console.log("\uD83D\uDCE7 Sending QR code email for business ".concat(y," via apiClient..."));let e=await W(),l=await b.x.sendClientQREmail(y,{qrCodeDataURL:e||N.qrCodeDataURL});if(l.success)q(!0),console.log("✅ QR code email sent successfully via apiClient"),setTimeout(()=>{q(!1)},3e3);else throw Error(l.error||"Failed to send QR code email")}catch(e){console.error("❌ Error sending QR code email via apiClient:",e),Z(e instanceof Error?e.message:"Unknown error")}finally{z(!1)}},W=()=>new Promise(e=>{if(!(null==N?void 0:N.qrCodeDataURL)){e(null);return}let l=document.createElement("canvas"),n=l.getContext("2d");if(l.width=1050,l.height=1350,n){n.fillStyle="#ffffff",n.fillRect(0,0,l.width,l.height),n.strokeStyle="#f97316",n.lineWidth=6,n.strokeRect(15,15,l.width-30,l.height-30);let t=60,a=new Image;a.onload=()=>{let s=(l.width-105)/2;n.drawImage(a,s,t,105,105),t+=135,n.textAlign="center",n.fillStyle="#f97316",n.font="bold 54px Arial",n.fillText("GLADGRADE ME",l.width/2,t),t+=40,n.fillStyle="#333333",n.font="bold 48px Arial",n.fillText(v.toUpperCase(),l.width/2,t),t+=60;let i=new Image;i.onload=()=>{let a=(l.width-450)/2;if(n.drawImage(i,a,t,450,450),t+=480,j&&U){for(let e of(n.fillStyle="#666666",n.font="36px Arial",j.split(",")))n.fillText(e.trim(),l.width/2,t),t+=40;t+=20}n.fillStyle="#f8fafc",n.fillRect(60,t,l.width-120,70),n.strokeStyle="#e2e8f0",n.lineWidth=2,n.strokeRect(60,t,l.width-120,70),n.fillStyle="#666666",n.font="26px Arial",n.fillText("1. Open Camera • 2. Scan Code • 3. Open/Download App • 4. Grade this Business",l.width/2,t+45),t+=90,n.strokeStyle="#e5e7eb",n.lineWidth=2,n.beginPath(),n.moveTo(100,t),n.lineTo(l.width-100,t),n.stroke(),n.fillStyle="#999999",n.font="24px Arial",n.fillText("Powered by GladGrade • www.gladgrade.com",l.width/2,t+35),e(l.toDataURL("image/png"))},i.src=N.qrCodeDataURL},a.onerror=()=>{t=60,n.textAlign="center",n.fillStyle="#f97316",n.font="bold 54px Arial",n.fillText("GLADGRADE ME",l.width/2,t),t+=40;let a=new Image;a.onload=()=>{n.fillStyle="#333333",n.font="bold 48px Arial",n.fillText(v.toUpperCase(),l.width/2,t),t+=60;let s=(l.width-450)/2;n.drawImage(a,s,t,450,450),t+=540,n.fillStyle="#f8fafc",n.fillRect(60,t,l.width-120,70),n.strokeStyle="#e2e8f0",n.lineWidth=2,n.strokeRect(60,t,l.width-120,70),n.fillStyle="#666666",n.font="26px Arial",n.fillText("1. Open Camera • 2. Scan Code • 3. Open/Download App • 4. Grade this Business",l.width/2,t+45),t+=90,n.strokeStyle="#e5e7eb",n.lineWidth=2,n.beginPath(),n.moveTo(100,t),n.lineTo(l.width-100,t),n.stroke(),n.fillStyle="#999999",n.font="24px Arial",n.fillText("Powered by GladGrade • www.gladgrade.com",l.width/2,t+35),e(l.toDataURL("image/png"))},a.src=N.qrCodeDataURL},a.src="/images/gladgrade-logo.png"}else e(null)});return(0,t.jsx)(s.Vq,{open:l,onOpenChange:n,children:(0,t.jsxs)(s.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(s.fK,{children:[(0,t.jsxs)(s.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Z,{className:"h-5 w-5"}),"QR Code for ",v]}),(0,t.jsx)(s.Be,{children:"Generate and manage QR codes for your business profile"})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(r.Zb,{className:"border-orange-200 bg-orange-50/50",children:(0,t.jsx)(r.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(c.Z,{className:"h-5 w-5 text-orange-600 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-orange-900",children:v}),j&&(0,t.jsxs)("div",{className:"text-sm text-orange-700 flex items-center gap-1 mt-1",children:[(0,t.jsx)(u.Z,{className:"h-3 w-3"}),j]}),(null==N?void 0:N.placeId)&&(0,t.jsxs)(o.C,{variant:"outline",className:"text-xs mt-2",children:["Place ID: ",N.placeId]})]})]})})}),k&&(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,t.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:"Generating QR code..."})]}),E&&(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsxs)("div",{className:"text-red-600 text-sm mb-2",children:["❌ ",E]}),(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:O,children:"Try Again"})]}),N&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"bg-white p-4 rounded-lg border-2 border-orange-500",children:(0,t.jsx)("img",{src:N.qrCodeDataURL,alt:"Business QR Code",className:"w-48 h-48"})})}),(0,t.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,t.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"QR Code URL:"}),(0,t.jsx)("div",{className:"text-xs font-mono break-all text-gray-700",children:N.qrUrl})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"includeBranding",checked:U,onChange:e=>L(e.target.checked),className:"rounded border-gray-300"}),(0,t.jsx)("label",{htmlFor:"includeBranding",className:"text-sm",children:"Include business name and address on printed QR code"})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500 ml-6",children:'Note: "GLAD GRADE ME" branding will always appear on printed QR codes'})]}),Q&&(0,t.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"QR code email sent successfully!"})]})}),_&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,t.jsxs)("div",{className:"text-red-700 text-sm",children:["❌ Error sending email: ",_]})})]})]}),(0,t.jsx)(s.cN,{className:"flex flex-col gap-2 sm:flex-row",children:N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:P,className:"flex-1 sm:flex-none",children:I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Z,{className:"h-3 w-3 mr-1"}),"Copied"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),"Copy URL"]})}),(0,t.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{(null==N?void 0:N.qrUrl)&&window.open(N.qrUrl,"_blank")},className:"flex-1 sm:flex-none",children:[(0,t.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),"Open"]})]}),(0,t.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,t.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{if(null==N?void 0:N.qrCodeDataURL){let e=document.createElement("a");e.download="".concat(v.replace(/[^a-zA-Z0-9]/g,"_"),"_QR_Code_Only.png"),e.href=N.qrCodeDataURL,e.click()}},className:"flex-1 sm:flex-none",children:[(0,t.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),"QR Only"]}),(0,t.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{if(null==N?void 0:N.qrCodeDataURL){let e=document.createElement("canvas"),l=e.getContext("2d");if(e.width=1050,e.height=1350,l){l.fillStyle="#ffffff",l.fillRect(0,0,e.width,e.height),l.strokeStyle="#f97316",l.lineWidth=6,l.strokeRect(15,15,e.width-30,e.height-30);let n=60,t=new Image;t.onload=()=>{let a=(e.width-105)/2;l.drawImage(t,a,n,105,105),n+=135,l.textAlign="center",l.fillStyle="#f97316",l.font="bold 54px Arial",l.fillText("GLADGRADE ME",e.width/2,n),n+=40,l.fillStyle="#333333",l.font="bold 48px Arial",l.fillText(v.toUpperCase(),e.width/2,n),n+=60;let s=new Image;s.onload=()=>{let t=(e.width-450)/2;if(l.drawImage(s,t,n,450,450),n+=480,j&&U){for(let t of(l.fillStyle="#666666",l.font="36px Arial",j.split(",")))l.fillText(t.trim(),e.width/2,n),n+=40;n+=20}l.fillStyle="#f8fafc",l.fillRect(60,n,e.width-120,70),l.strokeStyle="#e2e8f0",l.lineWidth=2,l.strokeRect(60,n,e.width-120,70),l.fillStyle="#666666",l.font="26px Arial",l.fillText("1. Open Camera • 2. Scan Code • 3. Open/Download App • 4. Grade this Business",e.width/2,n+45),n+=90,l.strokeStyle="#e5e7eb",l.lineWidth=2,l.beginPath(),l.moveTo(100,n),l.lineTo(e.width-100,n),l.stroke(),l.fillStyle="#999999",l.font="24px Arial",l.fillText("Powered by GladGrade • www.gladgrade.com",e.width/2,n+35),e.toBlob(e=>{if(e){let l=URL.createObjectURL(e),n=document.createElement("a");n.download="".concat(v.replace(/[^a-zA-Z0-9]/g,"_"),"_GladGrade_Full_Layout.png"),n.href=l,n.click(),URL.revokeObjectURL(l)}},"image/png")},s.src=N.qrCodeDataURL},t.src="/images/gladgrade-logo.png"}}},className:"flex-1 sm:flex-none",children:[(0,t.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),"Full Layout"]})]}),(0,t.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:B,disabled:T,className:"flex-1 sm:flex-none",children:T?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Z,{className:"h-3 w-3 mr-1 animate-spin"}),"Sending..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Z,{className:"h-3 w-3 mr-1"}),"Email to Client"]})}),(0,t.jsxs)(i.z,{onClick:()=>{if(null==N?void 0:N.qrCodeDataURL){let e=window.open("","_blank");e&&(e.document.write("\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <title>GladGrade QR Code - ".concat(v,'</title>\n            <style>\n              body {\n                margin: 0;\n                padding: 10px;\n                font-family: \'Arial\', sans-serif;\n                text-align: center;\n                background: white;\n                color: #1a1a1a;\n              }\n              .print-container {\n                max-width: 600px;\n                margin: 0 auto;\n                padding: 40px;\n                border: 3px solid #f97316;\n              }\n              .logo {\n                font-size: 32px;\n                font-weight: bold;\n                color: #f97316;\n                margin-bottom: 20px;\n              }\n              .title {\n                font-size: 28px;\n                font-weight: bold;\n                color: #f97316;\n                margin-bottom: 10px;\n              }\n              .business-name {\n                font-size: 24px;\n                font-weight: bold;\n                margin-bottom: 30px;\n                text-transform: uppercase;\n              }\n              .qr-code {\n                margin: 30px 0;\n              }\n              .qr-code img {\n                width: 300px;\n                height: 300px;\n                border: 2px solid #e5e7eb;\n              }\n              .address {\n                font-size: 18px;\n                color: #666;\n                margin: 20px 0;\n              }\n              .instructions {\n                background-color: #f8fafc;\n                border: 2px solid #e2e8f0;\n                padding: 15px;\n                margin: 20px 0;\n                font-size: 16px;\n                color: #666;\n              }\n              .footer {\n                border-top: 2px solid #e5e7eb;\n                padding-top: 15px;\n                margin-top: 30px;\n                font-size: 14px;\n                color: #999;\n              }\n              @media print {\n                body { print-color-adjust: exact; }\n                .print-container { border: 3px solid #f97316 !important; }\n              }\n            </style>\n          </head>\n          <body>\n            <div class="print-container">\n              <div class="logo">GladGrade</div>\n              <div class="title">GLADGRADE ME</div>\n              <div class="business-name">').concat(v,'</div>\n              <div class="qr-code">\n                <img src="').concat(N.qrCodeDataURL,'" alt="QR Code" />\n              </div>\n              ').concat(j&&U?'<div class="address">'.concat(j,"</div>"):"",'\n              <div class="instructions">\n                1. Open Camera • 2. Scan Code • 3. Open/Download App • 4. Grade this Business\n              </div>\n              <div class="footer">\n                Powered by GladGrade • www.gladgrade.com\n              </div>\n            </div>\n          </body>\n          </html>\n        ')),e.document.close(),e.print())}},className:"flex-1 sm:flex-none bg-orange-500 hover:bg-orange-600",children:[(0,t.jsx)(w.Z,{className:"h-3 w-3 mr-1"}),"Print QR Code"]})]})]})})]})})}},5516:function(e,l,n){n.d(l,{I8:function(){return c}});var t=n(738),a=n(3301),s=n(5978),i=n(62);console.log("Firebase Config Debug:",{apiKey:"✓ Set",authDomain:"✓ Set",projectId:"✓ Set",storageBucket:"✓ Set",messagingSenderId:"✓ Set",appId:"✓ Set"});let o={apiKey:"AIzaSyDD3_U64MVrZp2iNxYWVX9_hHytC9x_WVo",authDomain:"reactgladgrade.firebaseapp.com",projectId:"reactgladgrade",storageBucket:"reactgladgrade.appspot.com",messagingSenderId:"360532994710",appId:"1:360532994710:web:7376b3b3bab542567bf0b7",measurementId:"G-G7Y7B5CME3"},r=["apiKey","authDomain","projectId","appId"].filter(e=>!o[e]);if(r.length>0)throw console.error("Missing Firebase configuration fields:",r),console.error("Current config:",o),console.error("Make sure your .env.local file is in the root directory and restart the dev server"),Error("Missing Firebase configuration: ".concat(r.join(", ")));let d=null,c=null;try{d=(0,t.ZF)(o),c=(0,a.v0)(d),(0,s.ad)(d),(0,i.cF)(d),console.log("✅ Firebase initialized successfully")}catch(e){throw console.error("❌ Firebase initialization failed:",e),e}}}]);