(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2696],{2487:function(e,s,a){Promise.resolve().then(a.bind(a,9290))},9290:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return q}});var t=a(7437),r=a(2265),l=a(6070),i=a(2869),n=a(5186),o=a(5974),c=a(3647),d=a(3417),u=a(6362),m=a(6595),x=a(740),h=a(2369),g=a(3113),v=a(9205);let p=(0,v.Z)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var f=a(2208);let j=(0,v.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var y=a(407),b=a(5800),N=a(9376),w=a(3301),D=a(6818),k=a(1828),C=a(6815),I=a(6110),S=a(2339),Z=a(6865),P=a(8906),R=a(2489),F=a(3774),A=a(2720),E=a(1723),T=a(3229);let z=(0,v.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),M=(0,v.Z)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var L=a(44);let _=(0,v.Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var O=a(9322);function V(e){let{image:s,onClick:a,showModeration:l=!1,reviewId:n}=e,[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!0),m=()=>{let e="/dashboard/moderation?type=image&search=".concat(s.id);window.open(e,"_blank","noopener,noreferrer")};return(0,t.jsxs)("div",{className:"relative group border rounded-lg overflow-hidden bg-muted/30",children:[(0,t.jsxs)("div",{className:"aspect-square cursor-pointer relative overflow-hidden",onClick:a,children:[o?(0,t.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center text-muted-foreground bg-muted/50",children:[(0,t.jsx)(Z.Z,{className:"h-8 w-8 mb-2"}),(0,t.jsx)("span",{className:"text-xs text-center px-2",children:"Error loading image"}),(0,t.jsx)("a",{href:s.imageURL,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 mt-1 break-all px-2 text-center",onClick:e=>e.stopPropagation(),children:"View URL"})]}):(0,t.jsx)("img",{src:s.imageURL,alt:"Review image ".concat(s.orderByNumber||"untitled"),className:"w-full h-full object-cover transition-opacity duration-200 ".concat(d?"opacity-0":"opacity-100"," hover:scale-105 transition-transform duration-200"),onLoad:()=>u(!1),onError:()=>{c(!0),u(!1)},loading:"lazy"}),d&&!o&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/50",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-t-transparent"})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-200 flex items-center justify-center",children:(0,t.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,t.jsx)(g.Z,{className:"h-6 w-6 text-white"})})})]}),l&&(0,t.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,t.jsx)(i.z,{variant:"secondary",size:"sm",className:"h-6 w-6 p-0 bg-white/90 hover:bg-white shadow-md",onClick:e=>{e.stopPropagation(),m()},title:"Open in Content Moderation",children:(0,t.jsx)(P.Z,{className:"h-3 w-3"})})})]})}function B(e){let{image:s,isOpen:a,onClose:r}=e;return s?(0,t.jsx)(I.Vq,{open:a,onOpenChange:r,children:(0,t.jsxs)(I.cZ,{className:"max-w-4xl max-h-[90vh] p-2",children:[(0,t.jsx)(I.fK,{className:"pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(I.$N,{className:"text-sm",children:["Review Image ",s.orderByNumber?"#".concat(s.orderByNumber):""]}),(0,t.jsx)(i.z,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0",children:(0,t.jsx)(R.Z,{className:"h-4 w-4"})})]})}),(0,t.jsx)("div",{className:"flex items-center justify-center max-h-[calc(90vh-100px)] overflow-hidden",children:(0,t.jsx)("img",{src:s.imageURL,alt:"Review image ".concat(s.orderByNumber||"untitled"),className:"max-w-full max-h-full object-contain rounded-lg",onError:e=>{e.target.style.display="none"}})})]})}):null}function U(e){var s,a,n;let{isOpen:c,onClose:x,reviewId:g,onReviewUpdated:v}=e,{user:j,role:y}=(0,b.a)(),[N,Z]=(0,r.useState)(!1),[R,U]=(0,r.useState)(!1),[q,Q]=(0,r.useState)(null),[Y,G]=(0,r.useState)(""),[H,K]=(0,r.useState)(!1),[W,J]=(0,r.useState)(!1),[$,X]=(0,r.useState)(null),[ee,es]=(0,r.useState)(!1),ea=["super_admin","admin","employee","moderator"].includes(y||"");(0,r.useEffect)(()=>{c&&g&&(console.log("\uD83D\uDD04 Loading review details for ID:",g),console.log("\uD83D\uDCE8 Modal props changed:",{isOpen:c,reviewId:g}),et())},[c,g]);let et=async()=>{if(g){console.log("\uD83D\uDCE5 loadReviewDetails called with reviewId:",g),Z(!0);try{var e,s,a,t;let r={"Content-Type":"application/json"},l=(0,w.v0)().currentUser;if(l){let e=await l.getIdToken();r.Authorization="Bearer ".concat(e)}console.log("\uD83D\uDD0D Loading review details for reviewId:",g);let i=await fetch("/api/gcloud-proxy/consumerReviews/query",{method:"POST",headers:r,body:JSON.stringify({reviewIds:[g],includePrivate:!0})});if(!i.ok)throw console.error("Review API response not OK:",i.status),Error("Failed to load review details");let n=await i.json();console.log("\uD83D\uDCCB Review API Response:",n);let o=null===(e=n.data)||void 0===e?void 0:e[0];if(!o)throw console.error("No review found in response"),Error("Review not found");console.log("✅ Found review:",o);let c=[];try{let e=await fetch("/api/gcloud-proxy/reviews/all-images/".concat(o.id),{headers:r});e.ok&&(c=(await e.json()).data||[],console.log("\uD83D\uDDBC️ Loaded images:",c))}catch(e){console.warn("Could not load images:",e)}let d=[];try{console.log("\uD83D\uDCCA Loading survey answers for reviewId:",g);let e=await fetch("/api/gcloud-proxy/reviews/survey-answers/".concat(g),{method:"GET",headers:r});e.ok?(d=((await e.json()).data||[]).map(e=>{var s,a;return{id:(null===(s=e.id)||void 0===s?void 0:s.toString())||"",question:e.question||"Question text not available",answer:e.answer||"",surveyQuestionId:(null===(a=e.surveyQuestionId)||void 0===a?void 0:a.toString())||""}}),console.log("✅ Loaded ".concat(d.length," survey answers with questions")),console.log("\uD83D\uDCCA Survey answers:",d)):console.warn("Failed to fetch survey answers:",e.status)}catch(e){console.warn("Could not load survey answers:",e)}let u={id:(null===(s=o.id)||void 0===s?void 0:s.toString())||"",review:o.review||"",ratingValue:parseInt(o.ratingvalue,10)||parseInt(o.ratingValue,10)||0,reviewCreatedDate:o.datecreated||"",isPrivate:!!o.isprivate,hasImages:!!o.hasimages,imageCount:c.length,author:o.displayname||o.firstname||"Anonymous",userId:null===(a=o.userid)||void 0===a?void 0:a.toString(),placeName:o.placename||o.placeName||"Unknown Location",placeId:o.placeid||o.placeId||"",placeAddress:o.placeaddress||o.placeAddress||"",subcategory:o.subcategory||"",ratingId:(null===(t=o.consumerratingid)||void 0===t?void 0:t.toString())||"",images:c,surveyAnswers:d,replies:[]};console.log("✅ Formatted review details:",u),console.log("\uD83D\uDCCA Survey answers with questions:",u.surveyAnswers),Q(u),J(u.isPrivate)}catch(e){console.error("❌ Error loading review details:",e)}finally{Z(!1)}}},er=async()=>{if(q&&ea){U(!0);try{let e={"Content-Type":"application/json"},s=(0,w.v0)().currentUser;if(s){let a=await s.getIdToken();e.Authorization="Bearer ".concat(a);let t=await s.getIdTokenResult();console.log("\uD83D\uDD11 Current user token claims:",t.claims),console.log("\uD83D\uDD11 User email:",s.email),console.log("\uD83D\uDD11 User role from providers:",y)}console.log("\uD83D\uDCBE Saving privacy status:",{reviewId:q.id,currentPrivacy:q.isPrivate,newPrivacy:W,userRole:y,userEmail:null==j?void 0:j.email});let a={consumerReviewId:parseInt(q.id),isPrivate:W};console.log("\uD83D\uDCE4 Request body:",a);let t=await fetch("/api/gcloud-proxy/review/consumerReview/update",{method:"PATCH",headers:e,body:JSON.stringify(a)});if(console.log("\uD83D\uDCE1 Privacy update response status:",t.status),!t.ok){let e=await t.text();console.error("❌ Privacy update failed:",{status:t.status,statusText:t.statusText,responseBody:e});let s="Failed to update privacy status";try{let a=JSON.parse(e);s=a.error||s,console.error("❌ Parsed error:",a)}catch(s){console.error("❌ Could not parse error response:",e)}throw 403===t.status?s="Access denied. Your role (".concat(y,") may not have permission to edit reviews. Please contact an administrator."):401===t.status?s="Authentication failed. Please refresh the page and try again.":404===t.status&&(s="Review not found or you do not have permission to edit it."),Error(s)}let r=await t.json();console.log("✅ Privacy update successful:",r),Q(e=>e?{...e,isPrivate:W}:null),v&&v(),console.log("✅ Privacy status updated successfully")}catch(e){console.error("❌ Error updating privacy status:",e),J(q.isPrivate),alert(e instanceof Error?e.message:"Failed to update privacy status. Please try again.")}finally{U(!1)}}},el=async()=>{if(Y.trim()&&q){K(!0);try{console.log("Sending reply:",Y),console.log("To review:",q.id),G("")}catch(e){console.error("Error sending reply:",e)}finally{K(!1)}}},ei=e=>{X(e),es(!0)},en=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!c)return null;let eo=(null==q?void 0:null===(s=q.images)||void 0===s?void 0:s.filter(e=>1===e.imageTypeId||"Review Photo"===e.imageType))||[],ec=(null==q?void 0:null===(a=q.images)||void 0===a?void 0:a.filter(e=>2===e.imageTypeId||"Receipt"===e.imageType))||[],ed=eo.length>0,eu=ec.length>0,em=ed||eu;return(0,t.jsx)(I.Vq,{open:c,onOpenChange:x,children:(0,t.jsxs)(I.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background text-foreground",children:[(0,t.jsxs)(I.fK,{children:[(0,t.jsxs)(I.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Z,{className:"h-5 w-5 text-primary"}),"Review Details"]}),(0,t.jsx)(I.Be,{children:"Complete review information and customer interaction tools"})]}),N?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"}),(0,t.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading review details..."})]}):q?(0,t.jsxs)(S.mQ,{defaultValue:"overview",className:"space-y-4",children:[(0,t.jsxs)(S.dr,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(S.SP,{value:"overview",children:"Overview"}),(0,t.jsx)(S.SP,{value:"survey",children:"Survey Data"}),(0,t.jsx)(S.SP,{value:"images",children:"Images"}),(0,t.jsx)(S.SP,{value:"communication",children:"Communication"})]}),(0,t.jsx)(S.nU,{value:"overview",className:"space-y-6",children:(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(o.C,{variant:(n=q.ratingValue)>=9?"default":n>=7?"secondary":"destructive",children:[(0,t.jsx)(m.Z,{className:"h-3 w-3 mr-1"}),q.ratingValue,"/10"]}),q.isPrivate&&(0,t.jsxs)(o.C,{variant:"outline",className:"bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300",children:[(0,t.jsx)(p,{className:"h-3 w-3 mr-1"}),"Private"]}),!q.isPrivate&&(0,t.jsxs)(o.C,{variant:"outline",className:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300",children:[(0,t.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),"Public"]})]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:en(q.reviewCreatedDate)})]}),(0,t.jsx)(l.ll,{className:"text-lg",children:q.placeName}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(F.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm",children:q.placeAddress})]})]}),(0,t.jsx)(l.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(C._,{className:"font-medium",children:"Customer Review:"}),(0,t.jsx)("div",{className:"mt-2 p-4 bg-muted/50 rounded-lg",children:(0,t.jsx)("p",{className:"text-foreground leading-relaxed",children:q.review})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(C._,{className:"font-medium",children:"Customer:"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{children:q.author})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C._,{className:"font-medium",children:"Category:"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(A.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{children:q.subcategory||"General"})]})]})]}),ea&&(0,t.jsx)("div",{className:"border rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(C._,{className:"font-medium",children:"Privacy Settings"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Control whether this review is visible to the public"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(k.r,{id:"privacy-toggle",checked:W,onCheckedChange:J,disabled:R}),(0,t.jsx)(C._,{htmlFor:"privacy-toggle",className:"text-sm",children:W?"Private":"Public"})]}),W!==q.isPrivate&&(0,t.jsx)(i.z,{size:"sm",onClick:er,disabled:R,children:R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.Z,{className:"h-3 w-3 mr-1 animate-spin"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.Z,{className:"h-3 w-3 mr-1"}),"Save"]})})]})]})})]})})]})}),(0,t.jsx)(S.nU,{value:"survey",className:"space-y-4",children:(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[(0,t.jsx)(l.ll,{children:"Survey Responses"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Additional questions the customer answered about their experience"})]}),(0,t.jsx)(l.aY,{children:q.surveyAnswers&&q.surveyAnswers.length>0?(0,t.jsx)("div",{className:"space-y-4",children:q.surveyAnswers.map((e,s)=>(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsxs)(C._,{className:"font-medium text-sm",children:["Q",s+1,": ",e.question]}),(0,t.jsx)("p",{className:"mt-2 text-foreground",children:e.answer}),e.surveyQuestionId&&(0,t.jsxs)("p",{className:"mt-1 text-xs text-muted-foreground",children:["Question ID: ",e.surveyQuestionId]})]},e.id))}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(d.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"No survey responses available for this review"})]})})]})}),(0,t.jsx)(S.nU,{value:"images",className:"space-y-6",children:em?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[(0,t.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(z,{className:"h-5 w-5"}),"Review Images"]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Photos uploaded by the customer with their review"})]}),(0,t.jsx)(l.aY,{children:ed?(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:eo.map(e=>(0,t.jsx)(V,{image:e,onClick:()=>ei(e),showModeration:ea,reviewId:q.id},e.id))}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"No review photos attached"})]})})]}),eu&&(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(M,{className:"h-5 w-5"}),(0,t.jsx)(l.ll,{children:"Receipt Images"}),(0,t.jsxs)(o.C,{variant:"outline",className:"bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300",children:[(0,t.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),"Staff Only"]})]})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Receipt images uploaded by the customer (internal use only)"})]}),(0,t.jsx)(l.aY,{children:ea?(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:ec.map(e=>(0,t.jsx)(V,{image:e,onClick:()=>ei(e),showModeration:ea,reviewId:q.id},e.id))}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(P.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"You don't have clearance to view certain image types in this portal."}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Check with your system administrator."})]})})]}),ea&&em&&(0,t.jsx)(l.Zb,{className:"border-dashed",children:(0,t.jsx)(l.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(P.Z,{className:"h-5 w-5 text-blue-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Content Moderation"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Review and moderate all images for this review"})]})]}),(0,t.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{let e="/dashboard/moderation?type=image&search=".concat(q.id);window.open(e,"_blank","noopener,noreferrer")},className:"flex items-center gap-2",children:[(0,t.jsx)(u.Z,{className:"h-4 w-4"}),"Open Moderation"]})]})})})]}):null}),(0,t.jsxs)(S.nU,{value:"communication",className:"space-y-4",children:[q.replies&&q.replies.length>0&&(0,t.jsxs)(l.Zb,{children:[(0,t.jsx)(l.Ol,{children:(0,t.jsx)(l.ll,{children:"Previous Responses"})}),(0,t.jsx)(l.aY,{children:(0,t.jsx)("div",{className:"space-y-4",children:q.replies.map(e=>(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:e.fromBusiness?(0,t.jsx)(L.Z,{className:"h-8 w-8 p-1.5 bg-primary/10 text-primary rounded-full"}):(0,t.jsx)(h.Z,{className:"h-8 w-8 p-1.5 bg-muted text-muted-foreground rounded-full"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:e.authorName}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:en(e.dateCreated)}),e.fromBusiness&&(0,t.jsx)(o.C,{variant:"outline",className:"text-xs",children:"Business"})]}),(0,t.jsx)("p",{className:"text-sm text-foreground",children:e.message})]})]},e.id))})})]}),(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[(0,t.jsx)(l.ll,{children:"Send Response"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Reply to this customer review"})]}),(0,t.jsx)(l.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(D.g,{placeholder:"Type your response to the customer...",value:Y,onChange:e=>G(e.target.value),className:"min-h-[100px]"}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(i.z,{onClick:el,disabled:!Y.trim()||H,children:H?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_,{className:"h-4 w-4 mr-2"}),"Send Reply"]})})})]})})]})]})]}):(0,t.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,t.jsx)(O.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"Failed to load review details"})]}),(0,t.jsx)(I.cN,{children:(0,t.jsx)(i.z,{variant:"outline",onClick:x,children:"Close"})}),(0,t.jsx)(B,{image:$,isOpen:ee,onClose:()=>{es(!1),X(null)}})]})})}function q(){let{user:e,role:s,businessId:a}=(0,b.a)(),v=(0,N.useRouter)(),D=(0,N.useSearchParams)(),[k,C]=(0,r.useState)([]),[I,S]=(0,r.useState)([]),[Z,P]=(0,r.useState)([]),[R,F]=(0,r.useState)([]),[A,E]=(0,r.useState)(null),[T,z]=(0,r.useState)(!0),[M,L]=(0,r.useState)(!1),[_,O]=(0,r.useState)([]),[V,B]=(0,r.useState)([]),[q,Q]=(0,r.useState)(1),[Y,G]=(0,r.useState)(1),[H,K]=(0,r.useState)(0),[W,J]=(0,r.useState)({clientId:(null==D?void 0:D.get("clientId"))||"",placeId:(null==D?void 0:D.get("placeId"))||"",dateFrom:(null==D?void 0:D.get("dateFrom"))||"",dateTo:(null==D?void 0:D.get("dateTo"))||"",hasImages:(null==D?void 0:D.get("hasImages"))||"",ratingRange:(null==D?void 0:D.get("ratingRange"))||"",searchText:(null==D?void 0:D.get("search"))||"",privacyFilter:(null==D?void 0:D.get("privacyFilter"))||"all"}),[$,X]=(0,r.useState)(null),[ee,es]=(0,r.useState)(!1),ea="client"===s,et=["super_admin","admin","employee","moderator"].includes(s||"");(0,r.useEffect)(()=>{ea&&a&&ei()},[ea,a]),(0,r.useEffect)(()=>{et&&en()},[et]),(0,r.useEffect)(()=>{ed()},[V,ea,et]),(0,r.useEffect)(()=>{er()},[W,k]),(0,r.useEffect)(()=>{el()},[I,q]),(0,r.useEffect)(()=>{if(W.placeId)eo();else if(ea&&V.length>0){let e=_.find(e=>e.is_primary),s=(null==e?void 0:e.place_id)||V[0];s&&ec(s)}},[W.placeId,ea,V,_]);let er=()=>{let e=[...k];if("private"===W.privacyFilter?e=e.filter(e=>!0===e.isPrivate):"public"===W.privacyFilter&&(e=e.filter(e=>!1===e.isPrivate)),W.dateFrom){let s=new Date(W.dateFrom);e=e.filter(e=>new Date(e.reviewCreatedDate)>=s)}if(W.dateTo){let s=new Date(W.dateTo+" 23:59:59");e=e.filter(e=>new Date(e.reviewCreatedDate)<=s)}if("true"===W.hasImages?e=e.filter(e=>!0===e.hasImages):"false"===W.hasImages&&(e=e.filter(e=>!1===e.hasImages)),W.ratingRange){let[s,a]=W.ratingRange.split("-").map(e=>parseInt(e,10));isNaN(s)||isNaN(a)||(e=e.filter(e=>e.ratingValue>=s&&e.ratingValue<=a))}if(W.searchText&&W.searchText.trim()){let s=W.searchText.trim().toLowerCase();e=e.filter(e=>e.review.toLowerCase().includes(s)||e.placeName.toLowerCase().includes(s)||e.author.toLowerCase().includes(s)||e.placeAddress.toLowerCase().includes(s))}S(e),K(e.length),Q(1)},el=()=>{G(Math.ceil(I.length/10));let e=(q-1)*10;P(I.slice(e,e+10))},ei=async()=>{if(a)try{console.log("\uD83C\uDFE2 Loading business locations for client:",a);let e={"Content-Type":"application/json"},s=(0,w.v0)().currentUser;if(s){let a=await s.getIdToken();e.Authorization="Bearer ".concat(a)}let t=await fetch("/api/clients/".concat(a,"/locations"),{headers:e});if(t.ok){let e=(await t.json()).data||[];O(e);let s=e.filter(e=>e.place_id).map(e=>e.place_id);B(s),console.log("✅ Client business locations loaded:",e),console.log("✅ Client place IDs:",s)}else console.error("❌ Failed to load client business locations:",t.status,t.statusText)}catch(e){console.error("❌ Error loading client business locations:",e)}},en=async()=>{try{let s={};(null==e?void 0:e.email)&&(s["x-user-email"]=e.email);let a=await fetch("/api/clients",{headers:s});if(a.ok){let e=await a.json();F(e.data||[])}}catch(e){console.error("Error loading clients:",e)}},eo=async()=>{W.placeId&&ec(W.placeId)},ec=async e=>{L(!0);try{let s={"Content-Type":"application/json"},a=(0,w.v0)().currentUser;if(a){let e=await a.getIdToken();s.Authorization="Bearer ".concat(e)}let t=ea||et?"&includePrivate=true":"",r=await fetch("/api/gcloud-proxy/review-count?placeId=".concat(e).concat(t),{headers:s});if(r.ok){let e=await r.json();E(e.data)}}catch(e){console.error("Error loading review stats:",e)}finally{L(!1)}},ed=async()=>{z(!0);try{let e={"Content-Type":"application/json"},s=(0,w.v0)().currentUser;if(s){let a=await s.getIdToken();e.Authorization="Bearer ".concat(a)}let a={includePrivate:ea||et};ea&&W.placeId&&(a.placeId=W.placeId,console.log("\uD83C\uDFAF Client selected specific place ID:",W.placeId)),et&&(W.placeId&&(a.placeId=W.placeId),W.clientId&&(a.clientId=W.clientId)),console.log("\uD83D\uDCE4 Review request body:",a);let t=await fetch("/api/gcloud-proxy/consumerReviews/query",{method:"POST",headers:e,body:JSON.stringify(a)});if(t.ok){let e=await t.json();console.log("✅ Reviews API Response:",e);let s=(e.data||[]).map(e=>{var s,a;return{id:(null===(s=e.id)||void 0===s?void 0:s.toString())||"",ratingId:(null===(a=e.consumerratingid)||void 0===a?void 0:a.toString())||"",ratingValue:parseInt(e.ratingvalue,10)||parseInt(e.ratingValue,10)||0,review:e.review||"",placeName:e.placename||e.placeName||"Unknown Location",placeId:e.placeid||e.placeId||"",placeAddress:e.placeaddress||e.placeAddress||"",author:e.displayname||e.firstname||"Anonymous",reviewCreatedDate:e.datecreated||"",subcategory:e.subcategory||"",hasImages:!!e.hasimages,imageCount:e.imagecount||0,isPrivate:!!e.isprivate}});C(s),console.log("✅ Loaded ".concat(s.length," total reviews"))}else console.error("Failed to load reviews:",t.status),403===t.status&&console.error("❌ Access denied - user may be trying to access unauthorized data"),C([])}catch(e){console.error("Error loading reviews:",e),C([])}finally{z(!1)}},eu=(e,s)=>{let a="all"===s&&"privacyFilter"!==e?"":s;J(s=>({...s,[e]:a}));let t=new URLSearchParams(null==D?void 0:D.toString());a&&"all"!==a?t.set(e,a):t.delete(e),v.push("/dashboard/reviews?".concat(t.toString()))},em=e=>{X(e),es(!0)},ex=e=>e>=9?"default":e>=7?"secondary":"destructive",eh=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return ea&&a&&0===V.length&&!T?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading your business locations..."})]})}):T?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading reviews..."})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Customer Reviews"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 text-primary"}),(0,t.jsx)("span",{className:"text-sm text-foreground",children:ea?"Your Business Reviews":"Platform Review Management"}),ea&&_.length>0&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["• ",_.length," location",_.length>1?"s":""]})]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)(i.z,{variant:"outline",children:[(0,t.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Export Reviews"]})})]}),A&&(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-5",children:[(0,t.jsx)(l.Zb,{className:"border-border",children:(0,t.jsx)(l.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Z,{className:"h-5 w-5 text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-foreground",children:A.total_reviews}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})]})})}),(0,t.jsx)(l.Zb,{className:"border-border",children:(0,t.jsx)(l.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Z,{className:"h-5 w-5 text-yellow-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-foreground",children:A.average_rating||"N/A"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Avg Rating"})]})]})})}),(0,t.jsx)(l.Zb,{className:"border-border",children:(0,t.jsx)(l.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:A.rating_breakdown.good}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Good (9-10)"})]})})}),(0,t.jsx)(l.Zb,{className:"border-border",children:(0,t.jsx)(l.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-bold text-yellow-600 dark:text-yellow-400",children:A.rating_breakdown.mediocre}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Mediocre (7-8)"})]})})}),(0,t.jsx)(l.Zb,{className:"border-border",children:(0,t.jsx)(l.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:A.rating_breakdown.poor}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Poor (0-6)"})]})})})]}),(0,t.jsxs)(l.Zb,{className:"border-border",children:[(0,t.jsx)(l.Ol,{children:(0,t.jsxs)(l.ll,{className:"flex items-center gap-2 text-foreground",children:[(0,t.jsx)(x.Z,{className:"h-5 w-5"}),"Filters"]})}),(0,t.jsxs)(l.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[et&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Client"}),(0,t.jsxs)(c.Ph,{value:W.clientId||"all",onValueChange:e=>eu("clientId",e),children:[(0,t.jsx)(c.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(c.ki,{placeholder:"All Clients"})}),(0,t.jsxs)(c.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(c.Ql,{value:"all",className:"text-black hover:bg-gray-100",children:"All Clients"}),R.map(e=>(0,t.jsx)(c.Ql,{value:e.id.toString(),className:"text-black hover:bg-gray-100",children:e.business_name},e.id))]})]})]}),ea&&_.length>1&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Location"}),(0,t.jsxs)(c.Ph,{value:W.placeId||"all",onValueChange:e=>eu("placeId",e),children:[(0,t.jsx)(c.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(c.ki,{placeholder:"All Locations"})}),(0,t.jsxs)(c.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(c.Ql,{value:"all",className:"text-black hover:bg-gray-100",children:"All Locations"}),_.map(e=>(0,t.jsxs)(c.Ql,{value:e.place_id,className:"text-black hover:bg-gray-100",children:[e.location_name,e.is_primary&&" (Primary)"]},e.id))]})]})]}),(ea||et)&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Privacy"}),(0,t.jsxs)(c.Ph,{value:W.privacyFilter,onValueChange:e=>eu("privacyFilter",e),children:[(0,t.jsx)(c.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(c.ki,{placeholder:"All Reviews"})}),(0,t.jsxs)(c.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(c.Ql,{value:"all",className:"text-black hover:bg-gray-100",children:"All Reviews"}),(0,t.jsx)(c.Ql,{value:"public",className:"text-black hover:bg-gray-100",children:"Public Only"}),(0,t.jsx)(c.Ql,{value:"private",className:"text-black hover:bg-gray-100",children:"Private Only"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"From Date"}),(0,t.jsx)(n.I,{type:"date",value:W.dateFrom,onChange:e=>eu("dateFrom",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"To Date"}),(0,t.jsx)(n.I,{type:"date",value:W.dateTo,onChange:e=>eu("dateTo",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Images"}),(0,t.jsxs)(c.Ph,{value:W.hasImages||"all",onValueChange:e=>eu("hasImages",e),children:[(0,t.jsx)(c.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(c.ki,{placeholder:"All Reviews"})}),(0,t.jsxs)(c.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(c.Ql,{value:"all",className:"text-black hover:bg-gray-100",children:"All Reviews"}),(0,t.jsx)(c.Ql,{value:"true",className:"text-black hover:bg-gray-100",children:"With Images"}),(0,t.jsx)(c.Ql,{value:"false",className:"text-black hover:bg-gray-100",children:"Without Images"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Rating Range"}),(0,t.jsxs)(c.Ph,{value:W.ratingRange||"all",onValueChange:e=>eu("ratingRange",e),children:[(0,t.jsx)(c.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(c.ki,{placeholder:"All Ratings"})}),(0,t.jsxs)(c.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(c.Ql,{value:"all",className:"text-black hover:bg-gray-100",children:"All Ratings"}),(0,t.jsx)(c.Ql,{value:"0-6",className:"text-black hover:bg-gray-100",children:"Poor (0-6)"}),(0,t.jsx)(c.Ql,{value:"7-8",className:"text-black hover:bg-gray-100",children:"Mediocre (7-8)"}),(0,t.jsx)(c.Ql,{value:"9-10",className:"text-black hover:bg-gray-100",children:"Good (9-10)"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Search"}),(0,t.jsx)(n.I,{placeholder:"Search reviews...",value:W.searchText,onChange:e=>eu("searchText",e.target.value),className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",Z.length," of ",H," reviews",ea&&(0,t.jsxs)("span",{className:"text-primary",children:[" ","• Filtered for your business"]}),(ea||et)&&"all"!==W.privacyFilter&&(0,t.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:[" ","• ","private"===W.privacyFilter?"Private":"Public"," reviews only"]})]}),(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>{J({clientId:"",placeId:"",dateFrom:"",dateTo:"",hasImages:"",ratingRange:"",searchText:"",privacyFilter:"all"}),Q(1),v.push("/dashboard/reviews")},children:"Clear Filters"})]})]})]}),(0,t.jsxs)(l.Zb,{className:"border-border",children:[(0,t.jsx)(l.Ol,{children:(0,t.jsxs)(l.ll,{className:"text-foreground",children:["Reviews (",H,")"]})}),(0,t.jsx)(l.aY,{children:0===Z.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(d.Z,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/50"}),(0,t.jsx)("p",{className:"font-medium text-foreground",children:"No reviews found"}),(0,t.jsx)("p",{className:"text-sm",children:ea?"No reviews found for your business locations":"Try adjusting your filters or check back later"})]}):(0,t.jsx)("div",{className:"space-y-4",children:Z.map(e=>(0,t.jsxs)("div",{className:"border border-border rounded-lg p-4 hover:shadow-md transition-shadow bg-background",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(o.C,{variant:ex(e.ratingValue),children:[(0,t.jsx)(m.Z,{className:"h-3 w-3 mr-1"}),e.ratingValue,"/10"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-foreground",children:e.placeName}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:e.placeAddress})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(h.Z,{className:"h-3 w-3"}),e.author]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:eh(e.reviewCreatedDate)})]})]}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("p",{className:"text-foreground",children:e.review})}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.subcategory&&(0,t.jsx)(o.C,{variant:"outline",className:"text-xs border-border",children:e.subcategory}),e.hasImages&&(0,t.jsxs)(o.C,{variant:"outline",className:"text-xs border-border",children:[(0,t.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),e.imageCount||1," image",(e.imageCount||1)>1?"s":""]}),e.isPrivate&&(ea||et)&&(0,t.jsxs)(o.C,{variant:"outline",className:"text-xs border-border bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300",children:[(0,t.jsx)(p,{className:"h-3 w-3 mr-1"}),"Private"]}),!e.isPrivate&&(ea||et)&&"all"===W.privacyFilter&&(0,t.jsxs)(o.C,{variant:"outline",className:"text-xs border-border bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300",children:[(0,t.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),"Public"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>em(e.id),children:"View Details"}),et&&(0,t.jsx)(i.z,{variant:"outline",size:"sm",children:"Moderate"})]})]})]},e.id))})})]}),Y>1&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",q," of ",Y," • ",H," total reviews"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.z,{variant:"outline",size:"sm",disabled:q<=1,onClick:()=>Q(e=>Math.max(1,e-1)),children:[(0,t.jsx)(j,{className:"h-4 w-4 mr-1"}),"Previous"]}),(0,t.jsxs)(i.z,{variant:"outline",size:"sm",disabled:q>=Y,onClick:()=>Q(e=>Math.min(Y,e+1)),children:["Next",(0,t.jsx)(y.Z,{className:"h-4 w-4 ml-1"})]})]})]}),(0,t.jsx)(U,{isOpen:ee,onClose:()=>{es(!1),X(null)},reviewId:$,onReviewUpdated:()=>{ed()}})]})}},5800:function(e,s,a){"use strict";a.d(s,{Providers:function(){return x},a:function(){return d}});var t=a(7437),r=a(2265),l=a(3301),i=a(5516),n=a(5922);function o(e){let{children:s,...a}=e;return(0,t.jsx)(n.f,{...a,children:s})}let c=(0,r.createContext)({user:null,role:null,businessId:null,loading:!0,isFirebaseConfigured:!1}),d=()=>(0,r.useContext)(c);function u(e){if(console.log("\uD83D\uDD0D Determining role for email:",e),!e)return console.log("❌ No email provided, defaulting to client"),"client";let s=e.toLowerCase();return"miguel.giraldo@gladgrade.com"===s?(console.log("\uD83D\uDC51 Super Admin detected!"),"super_admin"):s.endsWith("@gladgrade.com")?(console.log("\uD83C\uDFE2 GladGrade employee detected"),s.includes("admin"))?(console.log("\uD83D\uDEE1️ Admin role assigned"),"admin"):s.includes("moderator")||s.includes("mod")?(console.log("\uD83D\uDD0D Moderator role assigned"),"moderator"):s.includes("support")||s.includes("employee")?(console.log("\uD83D\uDC64 Employee role assigned"),"employee"):(console.log("\uD83D\uDEE1️ Default admin role for GladGrade employee"),"admin"):(console.log("\uD83C\uDFEA Client role assigned"),"client")}function m(e){let{children:s}=e,[a,n]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[h,g]=(0,r.useState)(!0),[v,p]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(console.log("\uD83D\uDE80 AuthProvider useEffect running..."),console.log("\uD83D\uDD27 Firebase configured:",!0),p(!0),i.I8){console.log("\uD83D\uDD10 Setting up Firebase auth listener...");let e=(0,l.Aj)(i.I8,async e=>{if(console.log("\uD83D\uDD04 Auth state changed:",e?"User: ".concat(e.email):"No user"),n(e),e&&e.email)try{console.log("\uD83C\uDFAF Getting user role...");let s=await e.getIdTokenResult(),a=s.claims.role,t=null;console.log("\uD83C\uDFF7️ Custom claim role:",a),"client"===a&&s.claims.businessId&&(t=parseInt(s.claims.businessId),console.log("\uD83C\uDFE2 Client businessId extracted:",t)),a||(a=u(e.email),console.log("\uD83D\uDD10 Role assigned based on email domain: ".concat(e.email," → ").concat(a))),d(a),x(t),console.log("✅ Final role set:",a),console.log("✅ Final businessId set:",t)}catch(a){console.error("❌ Error getting user role:",a);let s=u(e.email);d(s),x(null),console.log("\uD83D\uDD04 Fallback role assigned: ".concat(e.email," → ").concat(s))}else console.log("\uD83D\uDC64 No user, setting role and businessId to null"),d(null),x(null);console.log("⏰ Setting loading to false"),g(!1)});return()=>{console.log("\uD83E\uDDF9 Cleaning up auth listener"),e()}}console.log("❌ Firebase not configured or auth not available"),g(!1)},[]),(0,t.jsx)(c.Provider,{value:{user:a,role:o,businessId:m,loading:h,isFirebaseConfigured:v},children:s})}function x(e){let{children:s}=e;return(0,t.jsx)(o,{attribute:"class",defaultTheme:"light",enableSystem:!0,disableTransitionOnChange:!1,children:(0,t.jsx)(m,{children:s})})}},6818:function(e,s,a){"use strict";a.d(s,{g:function(){return i}});var t=a(7437),r=a(2265),l=a(4508);let i=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...r})});i.displayName="Textarea"},407:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},9322:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1723:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},6362:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},2208:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},740:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},3113:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},3774:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},3417:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},3229:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},6595:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},2720:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])},2369:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9376:function(e,s,a){"use strict";var t=a(5475);a.o(t,"usePathname")&&a.d(s,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})},5516:function(e,s,a){"use strict";a.d(s,{I8:function(){return d}});var t=a(738),r=a(3301),l=a(5978),i=a(62);console.log("Firebase Config Debug:",{apiKey:"✓ Set",authDomain:"✓ Set",projectId:"✓ Set",storageBucket:"✓ Set",messagingSenderId:"✓ Set",appId:"✓ Set"});let n={apiKey:"AIzaSyDD3_U64MVrZp2iNxYWVX9_hHytC9x_WVo",authDomain:"reactgladgrade.firebaseapp.com",projectId:"reactgladgrade",storageBucket:"reactgladgrade.appspot.com",messagingSenderId:"360532994710",appId:"1:360532994710:web:7376b3b3bab542567bf0b7",measurementId:"G-G7Y7B5CME3"},o=["apiKey","authDomain","projectId","appId"].filter(e=>!n[e]);if(o.length>0)throw console.error("Missing Firebase configuration fields:",o),console.error("Current config:",n),console.error("Make sure your .env.local file is in the root directory and restart the dev server"),Error("Missing Firebase configuration: ".concat(o.join(", ")));let c=null,d=null;try{c=(0,t.ZF)(n),d=(0,r.v0)(c),(0,l.ad)(c),(0,i.cF)(c),console.log("✅ Firebase initialized successfully")}catch(e){throw console.error("❌ Firebase initialization failed:",e),e}}},function(e){e.O(0,[139,4358,6137,1709,3301,3774,7005,1153,600,4266,7033,4048,1626,2971,2117,1744],function(){return e(e.s=2487)}),_N_E=e.O()}]);