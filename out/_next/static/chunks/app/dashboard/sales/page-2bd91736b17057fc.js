(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6591],{7427:function(e,s,a){Promise.resolve().then(a.bind(a,7511))},7511:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return es}});var t=a(7437),r=a(2265),l=a(6070),n=a(2869),o=a(5974),i=a(1828),c=a(6815),d=a(5186),u=a(3647),m=a(1281),x=a(820),h=a(5868),g=a(9397),b=a(1473),v=a(7586),p=a(5805),j=a(8896),N=a(525),f=a(5252),_=a(3247),y=a(2489),w=a(740),C=a(6110),k=a(6818),S=a(3774),D=a(6595),I=a(5800);let F=[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"},{value:"DC",label:"District of Columbia"}];function A(e,s){let a=e.replace(/[^A-Za-z0-9]/g,"");switch(s){case"US":if(5===a.length)return a;if(9===a.length)return"".concat(a.slice(0,5),"-").concat(a.slice(5));return e;case"CA":if(6===a.length)return"".concat(a.slice(0,3)," ").concat(a.slice(3)).toUpperCase();return e.toUpperCase();case"MX":case"ES":case"IT":if(5===a.length)return a;return e;default:return e}}function P(e){let{trigger:s,onProspectCreated:a}=e,{user:o}=(0,I.a)(),[i,m]=(0,r.useState)(!1),[x,h]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[p,j]=(0,r.useState)(""),[N,f]=(0,r.useState)([]),[y,w]=(0,r.useState)(null),[P,Z]=(0,r.useState)(!0),[M,z]=(0,r.useState)({business_name:"",contact_name:"",contact_email:"",phone:"",street_address:"",city:"",state:"",zip_code:"",country:"US",formatted_address:"",website:"",estimated_value:"",priority:"medium",notes:"",place_id:""}),E=async()=>{if(p.trim()){v(!0);try{let e=await fetch("/api/clients/search-places?query=".concat(encodeURIComponent(p),"&location=Miami, FL")),s=await e.json();s.success?f(s.data||[]):(console.error("Search failed:",s.error),f([]))}catch(e){console.error("Search error:",e),f([])}finally{v(!1)}}},O=e=>{w(e);let s=function(e){let s={street_address:"",city:"",state:"",zip_code:"",country:"US"};if(e.address_components){let a="",t="",r="",l="";e.address_components.forEach(e=>{let n=e.types;n.includes("street_number")&&(a=e.long_name),n.includes("route")&&(t=e.long_name),n.includes("subpremise")&&(r=e.long_name),n.includes("premise")&&(l=e.long_name),n.includes("locality")&&(s.city=e.long_name),n.includes("administrative_area_level_1")&&(s.state=e.short_name),n.includes("postal_code")&&(s.zip_code=e.long_name),n.includes("country")&&(s.country=e.short_name)});let n=[];a&&t?n.push("".concat(a," ").concat(t)):t&&n.push(t),l&&n.push(l),r&&(r.toLowerCase().includes("suite")||r.toLowerCase().includes("apt")||r.toLowerCase().includes("unit")||r.toLowerCase().includes("#")||(r=/^\d+$/.test(r)&&parseInt(r)>50?"Suite ".concat(r):/^\d+[A-Za-z]$/.test(r)||50>=parseInt(r)?"Apt ".concat(r):"Unit ".concat(r)),n.push(r)),s.street_address=n.join(", ")}return s}(e);z(a=>({...a,business_name:e.name,place_id:e.place_id,formatted_address:e.formatted_address,street_address:s.street_address,city:s.city,state:s.state,zip_code:s.zip_code,country:s.country})),Z(!1)},Q=()=>{z({business_name:"",contact_name:"",contact_email:"",phone:"",street_address:"",city:"",state:"",zip_code:"",country:"US",formatted_address:"",website:"",estimated_value:"",priority:"medium",notes:"",place_id:""}),w(null),j(""),f([]),Z(!0)},T=async e=>{e.preventDefault(),h(!0);try{let e=A(M.zip_code,M.country),s={"Content-Type":"application/json"};(null==o?void 0:o.email)&&(s["x-user-email"]=o.email),console.log("\uD83D\uDD0D Creating prospect with authentication headers:",s),(await fetch("/api/sales/prospects",{method:"POST",headers:s,body:JSON.stringify({...M,zip_code:e,address:M.formatted_address||"".concat(M.street_address,", ").concat(M.city,", ").concat(M.state," ").concat(e)})})).ok?(m(!1),Q(),null==a||a()):console.error("Failed to create prospect")}catch(e){console.error("Error creating prospect:",e)}finally{h(!1)}},V=(e,s)=>{z(a=>({...a,[e]:s}))},L=e=>{let s=A(e,M.country);z(e=>({...e,zip_code:s}))};return(0,t.jsxs)(C.Vq,{open:i,onOpenChange:e=>{m(e),e||Q()},children:[(0,t.jsx)(C.hg,{asChild:!0,children:s||(0,t.jsxs)(n.z,{children:[(0,t.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"New Prospect"]})}),(0,t.jsxs)(C.cZ,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto bg-background text-foreground border-border",children:[(0,t.jsxs)(C.fK,{children:[(0,t.jsx)(C.$N,{className:"text-foreground",children:"Add New Prospect"}),(0,t.jsx)(C.Be,{className:"text-muted-foreground",children:"Search for a business or enter details manually to create a new sales prospect."})]}),P?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(d.I,{placeholder:"Search for business (e.g., 'Miami Beach Restaurant')",value:p,onChange:e=>j(e.target.value),onKeyPress:e=>"Enter"===e.key&&E(),className:"bg-background text-foreground border-border"}),(0,t.jsxs)(n.z,{onClick:E,disabled:b,children:[(0,t.jsx)(_.Z,{className:"h-4 w-4"}),b?"Searching...":"Search"]})]}),N.length>0&&(0,t.jsxs)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[(0,t.jsx)(c._,{className:"text-foreground",children:"Search Results:"}),N.map(e=>(0,t.jsx)(l.Zb,{className:"cursor-pointer hover:bg-muted/50 transition-colors border-border",onClick:()=>O(e),children:(0,t.jsx)(l.aY,{className:"p-3",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-medium text-foreground",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[(0,t.jsx)(S.Z,{className:"h-3 w-3 mr-1"}),e.formatted_address]}),e.rating&&(0,t.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[(0,t.jsx)(D.Z,{className:"h-3 w-3 mr-1 fill-yellow-400 text-yellow-400"}),e.rating," (",e.user_ratings_total," reviews)"]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.types.slice(0,3).join(", ")})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.business_status})]})})},e.place_id))]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(n.z,{variant:"outline",onClick:()=>{Z(!1),w(null),z(e=>({...e,place_id:""}))},children:"Enter Business Details Manually"})})]}):(0,t.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[y&&(0,t.jsx)(l.Zb,{className:"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:(0,t.jsx)(l.aY,{className:"p-3",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-green-800 dark:text-green-300",children:"Selected Business:"}),(0,t.jsx)("p",{className:"text-green-700 dark:text-green-400",children:y.name}),(0,t.jsx)("p",{className:"text-sm text-green-600 dark:text-green-500",children:y.formatted_address})]}),(0,t.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>Z(!0),children:"Change"})]})})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"business_name",className:"text-foreground",children:"Business Name *"}),(0,t.jsx)(d.I,{id:"business_name",value:M.business_name,onChange:e=>V("business_name",e.target.value),required:!0,className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"contact_name",className:"text-foreground",children:"Contact Name"}),(0,t.jsx)(d.I,{id:"contact_name",value:M.contact_name,onChange:e=>V("contact_name",e.target.value),className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"contact_email",className:"text-foreground",children:"Contact Email"}),(0,t.jsx)(d.I,{id:"contact_email",type:"email",value:M.contact_email,onChange:e=>V("contact_email",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"phone",className:"text-foreground",children:"Phone"}),(0,t.jsx)(d.I,{id:"phone",value:M.phone,onChange:e=>V("phone",e.target.value),className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t border-border pt-4",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground",children:"Address Information"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"street_address",className:"text-foreground",children:"Street Address"}),(0,t.jsx)(d.I,{id:"street_address",value:M.street_address,onChange:e=>V("street_address",e.target.value),placeholder:"123 Main Street",className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"city",className:"text-foreground",children:"City"}),(0,t.jsx)(d.I,{id:"city",value:M.city,onChange:e=>V("city",e.target.value),placeholder:"Miami",className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"state",className:"text-foreground",children:"State"}),(0,t.jsxs)(u.Ph,{value:M.state,onValueChange:e=>V("state",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{placeholder:"Select state"})}),(0,t.jsx)(u.Bw,{className:"bg-white border-gray-300",children:F.map(e=>(0,t.jsx)(u.Ql,{value:e.value,className:"text-black hover:bg-gray-100",children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"zip_code",className:"text-foreground",children:"ZIP Code"}),(0,t.jsx)(d.I,{id:"zip_code",value:M.zip_code,onChange:e=>L(e.target.value),placeholder:"33101 or 33101-1234",className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"country",className:"text-foreground",children:"Country"}),(0,t.jsxs)(u.Ph,{value:M.country,onValueChange:e=>V("country",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"US",className:"text-black hover:bg-gray-100",children:"United States"}),(0,t.jsx)(u.Ql,{value:"CA",className:"text-black hover:bg-gray-100",children:"Canada"}),(0,t.jsx)(u.Ql,{value:"MX",className:"text-black hover:bg-gray-100",children:"Mexico"}),(0,t.jsx)(u.Ql,{value:"ES",className:"text-black hover:bg-gray-100",children:"Spain"}),(0,t.jsx)(u.Ql,{value:"IT",className:"text-black hover:bg-gray-100",children:"Italy"})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"website",className:"text-foreground",children:"Website"}),(0,t.jsx)(d.I,{id:"website",value:M.website,onChange:e=>V("website",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"estimated_value",className:"text-foreground",children:"Estimated Value ($)"}),(0,t.jsx)(d.I,{id:"estimated_value",type:"number",value:M.estimated_value,onChange:e=>V("estimated_value",e.target.value),className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"priority",className:"text-foreground",children:"Priority"}),(0,t.jsxs)(u.Ph,{value:M.priority,onValueChange:e=>V("priority",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"low",className:"text-black hover:bg-gray-100",children:"Low"}),(0,t.jsx)(u.Ql,{value:"medium",className:"text-black hover:bg-gray-100",children:"Medium"}),(0,t.jsx)(u.Ql,{value:"high",className:"text-black hover:bg-gray-100",children:"High"}),(0,t.jsx)(u.Ql,{value:"urgent",className:"text-black hover:bg-gray-100",children:"Urgent"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"notes",className:"text-foreground",children:"Notes"}),(0,t.jsx)(k.g,{id:"notes",value:M.notes,onChange:e=>V("notes",e.target.value),rows:3,className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)(C.cN,{children:[(0,t.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>Z(!0),children:"Back to Search"}),(0,t.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),(0,t.jsx)(n.z,{type:"submit",disabled:x,children:x?"Creating...":"Create Prospect"})]})]})]})]})}var Z=a(9270),M=a(401),z=a(4508);let E=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(Z.fC,{ref:s,className:(0,z.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,t.jsx)(Z.z$,{className:(0,z.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(M.Z,{className:"h-4 w-4"})})})});E.displayName=Z.fC.displayName;var O=a(2369),Q=a(9322),T=a(1671),V=a(9345),L=a(7404),U=a(1817);function B(e){var s;let{isOpen:a,onClose:l,prospect:o,onSuccess:i}=e,[m,x]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),[b,v]=(0,r.useState)(null),[p,j]=(0,r.useState)({conversion_value:(null==o?void 0:null===(s=o.estimated_value)||void 0===s?void 0:s.toString())||"",serviceId:"",client_contact_name:(null==o?void 0:o.contact_name)||"",client_contact_email:(null==o?void 0:o.contact_email)||"",contactPhone:(null==o?void 0:o.contact_phone)||"",notes:"",send_welcome_email:!0,generate_qr_codes:!0,create_firebase_account:!0}),[N]=(0,r.useState)([{id:"1",name:"Basic Package",price:299,commission_rate:.15},{id:"2",name:"Premium Package",price:599,commission_rate:.2},{id:"3",name:"Enterprise Package",price:999,commission_rate:.25}]),_=N.find(e=>e.id===p.serviceId),y=Number.parseFloat(p.conversion_value||"0"),w=_?y*_.commission_rate:0,S=async e=>{if(e.preventDefault(),x(!0),g(null),v(null),!p.conversion_value||!p.client_contact_name||!p.client_contact_email){g("Please fill in all required fields (conversion value, contact name, and email)"),x(!1);return}if(!p.client_contact_email.includes("@")){g("Please enter a valid email address"),x(!1);return}let s=Number.parseFloat(p.conversion_value);if(isNaN(s)||s<=0){g("Please enter a valid conversion value greater than 0"),x(!1);return}try{console.log("Converting prospect:",{prospect_id:o.id,conversion_value:s,client_contact_name:p.client_contact_name,client_contact_email:p.client_contact_email});let e=await fetch("/api/sales/prospects/convert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prospect_id:o.id,conversion_value:s,client_contact_name:p.client_contact_name,client_contact_email:p.client_contact_email,client_contact_phone:p.contactPhone,notes:p.notes,send_welcome_email:p.send_welcome_email,generate_qr_codes:p.generate_qr_codes,create_firebase_account:p.create_firebase_account})}),a=await e.json();if(console.log("Conversion response:",a),!e.ok)throw Error(a.details||a.error||"Failed to convert prospect");if(a.success)v(a.message||"Prospect converted to client successfully!"),setTimeout(()=>{i(),l(),D()},2e3);else throw Error(a.error||"Conversion failed")}catch(e){console.error("Conversion error:",e),g(e instanceof Error?e.message:"Failed to convert prospect. Please try again.")}finally{x(!1)}},D=()=>{var e;j({conversion_value:(null==o?void 0:null===(e=o.estimated_value)||void 0===e?void 0:e.toString())||"",serviceId:"",client_contact_name:(null==o?void 0:o.contact_name)||"",client_contact_email:(null==o?void 0:o.contact_email)||"",contactPhone:(null==o?void 0:o.contact_phone)||"",notes:"",send_welcome_email:!0,generate_qr_codes:!0,create_firebase_account:!0}),g(null),v(null)},I=(e,s)=>{j(a=>({...a,[e]:s}))};return(0,t.jsx)(C.Vq,{open:a,onOpenChange:l,children:(0,t.jsxs)(C.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto bg-background text-foreground border-border",children:[(0,t.jsx)(C.fK,{children:(0,t.jsxs)(C.$N,{className:"flex items-center gap-2 text-foreground",children:[(0,t.jsx)(O.Z,{className:"h-5 w-5"}),"Convert Prospect to Client"]})}),h&&(0,t.jsxs)("div",{className:"bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-md p-3 flex items-start gap-2",children:[(0,t.jsx)(Q.Z,{className:"h-5 w-5 text-red-500 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-red-800 dark:text-red-300",children:"Error"}),(0,t.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:h})]})]}),b&&(0,t.jsxs)("div",{className:"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-md p-3 flex items-start gap-2",children:[(0,t.jsx)(T.Z,{className:"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-green-800 dark:text-green-300",children:"Success!"}),(0,t.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:b})]})]}),(0,t.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg border border-border",children:[(0,t.jsx)("h3",{className:"font-medium mb-2 text-foreground",children:"Prospect Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Business:"}),(0,t.jsx)("span",{className:"text-muted-foreground ml-1",children:null==o?void 0:o.business_name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Status:"}),(0,t.jsx)("span",{className:"text-muted-foreground ml-1",children:null==o?void 0:o.status})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Priority:"}),(0,t.jsx)("span",{className:"text-muted-foreground ml-1",children:null==o?void 0:o.priority})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Estimated Value:"}),(0,t.jsxs)("span",{className:"text-muted-foreground ml-1",children:["$",(null==o?void 0:o.estimated_value)||0]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"font-medium flex items-center gap-2 text-foreground",children:[(0,t.jsx)(f.Z,{className:"h-4 w-4"}),"Conversion Details"]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"conversion_value",className:"text-foreground",children:"Final Sale Value ($) *"}),(0,t.jsx)(d.I,{id:"conversion_value",type:"number",step:"0.01",placeholder:"0.00",value:p.conversion_value,onChange:e=>I("conversion_value",e.target.value),required:!0,className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"serviceId",className:"text-foreground",children:"Service Package (Optional)"}),(0,t.jsxs)(u.Ph,{onValueChange:e=>I("serviceId",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{placeholder:"Select service"})}),(0,t.jsx)(u.Bw,{className:"bg-white border-gray-300",children:N.map(e=>(0,t.jsxs)(u.Ql,{value:e.id,className:"text-black hover:bg-gray-100",children:[e.name," - $",e.price," (",100*e.commission_rate,"% commission)"]},e.id))})]})]})]}),w>0&&(0,t.jsx)("div",{className:"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 p-3 rounded-lg",children:(0,t.jsxs)("p",{className:"text-green-800 dark:text-green-300 font-medium",children:["Estimated Commission: $",w.toFixed(2)]})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground",children:"Client Contact Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"client_contact_name",className:"text-foreground",children:"Contact Name *"}),(0,t.jsx)(d.I,{id:"client_contact_name",value:p.client_contact_name,onChange:e=>I("client_contact_name",e.target.value),required:!0,className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"client_contact_email",className:"text-foreground",children:"Contact Email *"}),(0,t.jsx)(d.I,{id:"client_contact_email",type:"email",value:p.client_contact_email,onChange:e=>I("client_contact_email",e.target.value),required:!0,className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"contactPhone",className:"text-foreground",children:"Contact Phone (Optional)"}),(0,t.jsx)(d.I,{id:"contactPhone",value:p.contactPhone,onChange:e=>I("contactPhone",e.target.value),className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground",children:"Automation Options"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(E,{id:"send_welcome_email",checked:p.send_welcome_email,onCheckedChange:e=>I("send_welcome_email",!!e)}),(0,t.jsxs)(c._,{htmlFor:"send_welcome_email",className:"flex items-center gap-2 text-foreground",children:[(0,t.jsx)(V.Z,{className:"h-4 w-4"}),"Send welcome email with portal access"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(E,{id:"generate_qr_codes",checked:p.generate_qr_codes,onCheckedChange:e=>I("generate_qr_codes",!!e)}),(0,t.jsxs)(c._,{htmlFor:"generate_qr_codes",className:"flex items-center gap-2 text-foreground",children:[(0,t.jsx)(L.Z,{className:"h-4 w-4"}),"Generate QR codes (business profile + menu)"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(E,{id:"create_firebase_account",checked:p.create_firebase_account,onCheckedChange:e=>I("create_firebase_account",!!e)}),(0,t.jsxs)(c._,{htmlFor:"create_firebase_account",className:"flex items-center gap-2 text-foreground",children:[(0,t.jsx)(O.Z,{className:"h-4 w-4"}),"Create client portal account"]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"notes",className:"text-foreground",children:"Conversion Notes (Optional)"}),(0,t.jsx)(k.g,{id:"notes",placeholder:"Add any notes about this conversion...",value:p.notes,onChange:e=>I("notes",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[(0,t.jsx)(n.z,{type:"button",variant:"outline",onClick:l,children:"Cancel"}),(0,t.jsx)(n.z,{type:"submit",disabled:m,className:"bg-green-600 hover:bg-green-700 text-white",children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Converting..."]}):"Convert to Client"})]})]})]})})}var R=a(2339),Y=a(8617),q=a(8906),W=a(3041),K=a(1047),$=a(6865),H=a(44);let G=[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"},{value:"DC",label:"District of Columbia"}];function J(e,s){let a=e.replace(/[^A-Za-z0-9]/g,"");switch(s){case"US":if(5===a.length)return a;if(9===a.length)return"".concat(a.slice(0,5),"-").concat(a.slice(5));return e;case"CA":if(6===a.length)return"".concat(a.slice(0,3)," ").concat(a.slice(3)).toUpperCase();return e.toUpperCase();case"MX":case"ES":case"IT":if(5===a.length)return a;return e;default:return e}}function X(e,s){return e.id===s?1:"CEO"===e.position_title?2:"CCO"===e.position_title?3:"Sales Manager"===e.position_title||"sales_manager"===e.legacy_role?4:e.has_sales_access||e.primary_is_sales?5:6}function ee(e){let{isOpen:s,onClose:a,prospect:i,onSuccess:m,userRole:x}=e,{user:h}=(0,I.a)(),[g,b]=(0,r.useState)(!1),[v,j]=(0,r.useState)([]),[N,_]=(0,r.useState)(!1),[y,w]=(0,r.useState)([]),[S,F]=(0,r.useState)([]),[A,P]=(0,r.useState)(!1),[Z,M]=(0,r.useState)(""),[z,E]=(0,r.useState)(!1),[Q,T]=(0,r.useState)({business_name:"",contact_name:"",contact_email:"",phone:"",street_address:"",city:"",state:"",zip_code:"",country:"US",formatted_address:"",website:"",business_type:"",estimated_value:"",priority:"medium",status:"new",notes:"",assigned_salesperson_id:""}),[L,U]=(0,r.useState)({activity_type:"call",subject:"",description:""}),B=["super_admin","sales_manager"].includes(x);(0,r.useEffect)(()=>{if(i){var e;console.log("\uD83D\uDD0D Loading prospect data:",i),T({business_name:i.business_name||"",contact_name:i.contact_name||"",contact_email:i.contact_email||"",phone:i.phone||"",street_address:i.street_address||"",city:i.city||"",state:i.state||"",zip_code:i.zip_code||"",country:i.country||"US",formatted_address:i.formatted_address||"",website:i.website||"",business_type:i.business_type||"",estimated_value:i.estimated_value?i.estimated_value.toString():"",priority:i.priority||"medium",status:i.status||"new",notes:i.notes||"",assigned_salesperson_id:(null===(e=i.assigned_salesperson_id)||void 0===e?void 0:e.toString())||""}),ea(),ee(),es()}},[i]);let ee=async()=>{try{let e=await fetch("/api/business-sectors");if(e.ok){let s=await e.json();w(s.data||[])}}catch(e){console.error("Error loading business sectors:",e)}},es=async()=>{P(!0);try{let e={};(null==h?void 0:h.email)&&(e["x-user-email"]=h.email);let s=await fetch("/api/employees/enhanced",{headers:e});if(s.ok){let e=await s.json();console.log("\uD83D\uDD0D Raw employee data:",e.data);let a=(e.data||[]).filter(e=>{var s;let a="active"===e.status;if(!a)return console.log("❌ Skipping inactive employee: ".concat(e.full_name," (status: ").concat(e.status,")")),!1;let t=e.has_sales_access||e.primary_is_sales||"CEO"===e.position_title,r=["super_admin","admin","sales_manager","sales","employee"].includes(e.legacy_role),l=null===(s=e.department_name)||void 0===s?void 0:s.toLowerCase().includes("sales"),n=e.position_title&&["CEO","CCO","Sales Manager","Sales Director","Sales Representative","Account Manager"].includes(e.position_title);return console.log("\uD83D\uDD0D Employee ".concat(e.full_name,":"),{isActive:a,hasEnhancedSalesAccess:t,hasLegacySalesAccess:r,isInSalesDept:l,hasSalesPosition:n,legacy_role:e.legacy_role,position_title:e.position_title,department_name:e.department_name,status:e.status}),a&&(t||r||l||n)});console.log("\uD83D\uDD0D Filtered sales employees:",a.length);let t=a.sort((e,s)=>{let a=X(e,null==i?void 0:i.assigned_salesperson_id),t=X(s,null==i?void 0:i.assigned_salesperson_id);return a!==t?a-t:e.full_name.localeCompare(s.full_name)});F(t),console.log("✅ Loaded and sorted sales employees:",t.length,t)}else console.error("Failed to load sales employees:",s.status,s.statusText)}catch(e){console.error("Error loading sales employees:",e)}finally{P(!1)}},ea=async()=>{if(null==i?void 0:i.id){_(!0);try{let e={};(null==h?void 0:h.email)&&(e["x-user-email"]=h.email);let s=await fetch("/api/sales/activities?prospect_id=".concat(i.id),{headers:e});if(s.ok){let e=await s.json();j(e.data||[])}}catch(e){console.error("Error loading activities:",e)}finally{_(!1)}}},et=async()=>{if(!L.subject.trim()){alert("Please enter a subject for the activity");return}try{let e={"Content-Type":"application/json"};(null==h?void 0:h.email)&&(e["x-user-email"]=h.email),console.log("\uD83D\uDD0D Adding activity with headers:",e);let s=await fetch("/api/sales/activities",{method:"POST",headers:e,body:JSON.stringify({prospect_id:i.id,...L})});if(s.ok)U({activity_type:"call",subject:"",description:""}),ea(),alert("Activity added successfully!");else{let e=await s.json();console.error("Failed to add activity:",e),alert("Failed to add activity: ".concat(e.error))}}catch(e){console.error("Error adding activity:",e),alert("Error adding activity")}},er=(e,s)=>{T(a=>({...a,[e]:s}))},el=e=>{let s=J(e,Q.country);T(e=>({...e,zip_code:s}))},en=async e=>{e.preventDefault(),b(!0);try{var s;let e={"Content-Type":"application/json"};(null==h?void 0:h.email)&&(e["x-user-email"]=h.email),console.log("\uD83D\uDD0D Submitting prospect update with headers:",e),console.log("\uD83D\uDD0D Form data:",Q);let t=J(Q.zip_code,Q.country),r="".concat(Q.street_address,", ").concat(Q.city,", ").concat(Q.state," ").concat(t).trim(),l=Q.assigned_salesperson_id!==(null===(s=i.assigned_salesperson_id)||void 0===s?void 0:s.toString()),n={id:i.id,...Q,zip_code:t,formatted_address:Q.formatted_address||r,estimated_value:Number.parseFloat(Q.estimated_value)||0,assigned_salesperson_id:Number.parseInt(Q.assigned_salesperson_id)||i.assigned_salesperson_id};l&&B&&(n.change_reason=Z||"Prospect reassignment via edit modal");let o=await fetch("/api/sales/prospects",{method:"PUT",headers:e,body:JSON.stringify(n)});if(o.ok)m(),a(),M(""),E(!1);else{let e=await o.json();console.error("❌ Failed to update prospect:",e),alert("Failed to update prospect: ".concat(e.error))}}catch(e){console.error("❌ Error updating prospect:",e),alert("Error updating prospect")}finally{b(!1)}};return i?(0,t.jsx)(C.Vq,{open:s,onOpenChange:a,children:(0,t.jsxs)(C.cZ,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto bg-background text-foreground border-border",children:[(0,t.jsxs)(C.fK,{children:[(0,t.jsxs)(C.$N,{className:"flex items-center gap-3 text-foreground",children:[(0,t.jsx)(H.Z,{className:"h-5 w-5"}),i.business_name,(0,t.jsx)(o.C,{className:"bg-blue-100 text-blue-800 dark:bg-blue-950/20 dark:text-blue-300",children:i.status})]}),(0,t.jsx)(C.Be,{className:"text-muted-foreground",children:"Edit prospect information and manage sales activities"})]}),(0,t.jsxs)(R.mQ,{defaultValue:"details",className:"w-full",children:[(0,t.jsxs)(R.dr,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(R.SP,{value:"details",children:"Details"}),(0,t.jsxs)(R.SP,{value:"activities",children:["Activities (",v.length,")"]})]}),(0,t.jsx)(R.nU,{value:"details",className:"space-y-4",children:(0,t.jsxs)("form",{onSubmit:en,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"business_name",className:"text-foreground",children:"Business Name *"}),(0,t.jsx)(d.I,{id:"business_name",value:Q.business_name,onChange:e=>er("business_name",e.target.value),required:!0,className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"contact_name",className:"text-foreground",children:"Contact Name"}),(0,t.jsx)(d.I,{id:"contact_name",value:Q.contact_name,onChange:e=>er("contact_name",e.target.value),className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"contact_email",className:"text-foreground",children:"Contact Email"}),(0,t.jsx)(d.I,{id:"contact_email",type:"email",value:Q.contact_email,onChange:e=>er("contact_email",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"phone",className:"text-foreground",children:"Phone"}),(0,t.jsx)(d.I,{id:"phone",value:Q.phone,onChange:e=>er("phone",e.target.value),className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t border-border pt-4",children:[(0,t.jsxs)("h3",{className:"font-medium flex items-center gap-2 text-foreground",children:[(0,t.jsx)(p.Z,{className:"h-4 w-4"}),"Assignment & Ownership"]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(c._,{htmlFor:"assigned_salesperson_id",className:"text-foreground",children:["Assigned Sales Representative *",!B&&(0,t.jsxs)(o.C,{variant:"outline",className:"ml-2 text-xs",children:[(0,t.jsx)(q.Z,{className:"h-3 w-3 mr-1"}),"Read Only"]})]}),(0,t.jsxs)(u.Ph,{value:Q.assigned_salesperson_id,onValueChange:e=>{var s;e!==(null===(s=i.assigned_salesperson_id)||void 0===s?void 0:s.toString())&&B&&E(!0),T(s=>({...s,assigned_salesperson_id:e}))},disabled:!B||A,children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{placeholder:A?"Loading employees...":"Select sales representative"})}),(0,t.jsx)(u.Bw,{className:"bg-white border-gray-300",children:S.map(e=>{var s;let a=e.id===i.assigned_salesperson_id;return(0,t.jsx)(u.Ql,{value:e.id.toString(),className:"text-black hover:bg-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(s=i.assigned_salesperson_id,e.id===s?(0,t.jsx)(D.Z,{className:"h-3 w-3 text-yellow-500"}):"CEO"===e.position_title?(0,t.jsx)(Y.Z,{className:"h-3 w-3 text-purple-500"}):"CCO"===e.position_title?(0,t.jsx)(q.Z,{className:"h-3 w-3 text-blue-500"}):"Sales Manager"===e.position_title||"sales_manager"===e.legacy_role?(0,t.jsx)(p.Z,{className:"h-3 w-3 text-green-500"}):(0,t.jsx)(O.Z,{className:"h-3 w-3 text-gray-500"})),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:e.full_name}),a&&(0,t.jsx)(o.C,{variant:"outline",className:"text-xs",children:"Current Owner"})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.position_title||e.primary_role_name||e.legacy_role,e.department_name&&" • ".concat(e.department_name)]})]})]})},e.id)})})]}),!B&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,t.jsx)($.Z,{className:"h-3 w-3 inline mr-1"}),"Only Sales Managers and Super Admins can reassign prospects to other team members."]})]}),z&&(0,t.jsxs)("div",{className:"space-y-2 p-4 bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[(0,t.jsx)(c._,{htmlFor:"change_reason",className:"text-foreground",children:"Reason for Assignment Change"}),(0,t.jsx)(k.g,{id:"change_reason",value:Z,onChange:e=>M(e.target.value),placeholder:"Please provide a reason for changing the prospect assignment...",rows:2,className:"bg-background text-foreground border-border"}),(0,t.jsx)("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"This change will be logged in the audit system for compliance tracking."})]})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t border-border pt-4",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground",children:"Address Information"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"street_address",className:"text-foreground",children:"Street Address"}),(0,t.jsx)(d.I,{id:"street_address",value:Q.street_address,onChange:e=>er("street_address",e.target.value),placeholder:"123 Main Street",className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"city",className:"text-foreground",children:"City"}),(0,t.jsx)(d.I,{id:"city",value:Q.city,onChange:e=>er("city",e.target.value),placeholder:"Miami",className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"state",className:"text-foreground",children:"State"}),(0,t.jsxs)(u.Ph,{value:Q.state,onValueChange:e=>er("state",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{placeholder:"Select state"})}),(0,t.jsx)(u.Bw,{className:"bg-white border-gray-300",children:G.map(e=>(0,t.jsx)(u.Ql,{value:e.value,className:"text-black hover:bg-gray-100",children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"zip_code",className:"text-foreground",children:"ZIP Code"}),(0,t.jsx)(d.I,{id:"zip_code",value:Q.zip_code,onChange:e=>el(e.target.value),placeholder:"33101 or 33101-1234",className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"country",className:"text-foreground",children:"Country"}),(0,t.jsxs)(u.Ph,{value:Q.country,onValueChange:e=>er("country",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"US",className:"text-black hover:bg-gray-100",children:"United States"}),(0,t.jsx)(u.Ql,{value:"CA",className:"text-black hover:bg-gray-100",children:"Canada"}),(0,t.jsx)(u.Ql,{value:"MX",className:"text-black hover:bg-gray-100",children:"Mexico"}),(0,t.jsx)(u.Ql,{value:"ES",className:"text-black hover:bg-gray-100",children:"Spain"}),(0,t.jsx)(u.Ql,{value:"IT",className:"text-black hover:bg-gray-100",children:"Italy"})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"website",className:"text-foreground",children:"Website"}),(0,t.jsx)(d.I,{id:"website",value:Q.website,onChange:e=>er("website",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"business_type",className:"text-foreground",children:"Industry"}),(0,t.jsxs)(u.Ph,{value:Q.business_type,onValueChange:e=>er("business_type",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{placeholder:"Select industry"})}),(0,t.jsx)(u.Bw,{className:"bg-white border-gray-300",children:y.map(e=>(0,t.jsx)(u.Ql,{value:e.businesssectorname,className:"text-black hover:bg-gray-100",children:e.businesssectorname},e.id))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"estimated_value",className:"text-foreground",children:"Estimated Value ($)"}),(0,t.jsx)(d.I,{id:"estimated_value",type:"number",step:"0.01",value:Q.estimated_value,onChange:e=>er("estimated_value",e.target.value),className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"priority",className:"text-foreground",children:"Priority"}),(0,t.jsxs)(u.Ph,{value:Q.priority,onValueChange:e=>er("priority",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"low",className:"text-black hover:bg-gray-100",children:"Low"}),(0,t.jsx)(u.Ql,{value:"medium",className:"text-black hover:bg-gray-100",children:"Medium"}),(0,t.jsx)(u.Ql,{value:"high",className:"text-black hover:bg-gray-100",children:"High"}),(0,t.jsx)(u.Ql,{value:"urgent",className:"text-black hover:bg-gray-100",children:"Urgent"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"status",className:"text-foreground",children:"Status"}),(0,t.jsxs)(u.Ph,{value:Q.status,onValueChange:e=>er("status",e),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"new",className:"text-black hover:bg-gray-100",children:"New"}),(0,t.jsx)(u.Ql,{value:"contacted",className:"text-black hover:bg-gray-100",children:"Contacted"}),(0,t.jsx)(u.Ql,{value:"qualified",className:"text-black hover:bg-gray-100",children:"Qualified"}),(0,t.jsx)(u.Ql,{value:"proposal",className:"text-black hover:bg-gray-100",children:"Proposal"}),(0,t.jsx)(u.Ql,{value:"negotiation",className:"text-black hover:bg-gray-100",children:"Negotiation"}),(0,t.jsx)(u.Ql,{value:"converted",className:"text-black hover:bg-gray-100",children:"Converted"}),(0,t.jsx)(u.Ql,{value:"lost",className:"text-black hover:bg-gray-100",children:"Lost"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"notes",className:"text-foreground",children:"Notes"}),(0,t.jsx)(k.g,{id:"notes",value:Q.notes,onChange:e=>er("notes",e.target.value),rows:3,className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)(C.cN,{children:[(0,t.jsx)(n.z,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),(0,t.jsx)(n.z,{type:"submit",disabled:g,children:g?"Saving...":"Save Changes"})]})]})}),(0,t.jsxs)(R.nU,{value:"activities",className:"space-y-4",children:[(0,t.jsxs)(l.Zb,{className:"border-border",children:[(0,t.jsx)(l.Ol,{children:(0,t.jsxs)(l.ll,{className:"text-sm flex items-center gap-2 text-foreground",children:[(0,t.jsx)(K.Z,{className:"h-4 w-4"}),"Add New Activity"]})}),(0,t.jsxs)(l.aY,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"activity_type",className:"text-foreground",children:"Activity Type"}),(0,t.jsxs)(u.Ph,{value:L.activity_type,onValueChange:e=>U(s=>({...s,activity_type:e})),children:[(0,t.jsx)(u.i4,{className:"bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"call",className:"text-black hover:bg-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(W.Z,{className:"h-4 w-4 text-green-500"}),"Phone Call"]})}),(0,t.jsx)(u.Ql,{value:"email",className:"text-black hover:bg-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(V.Z,{className:"h-4 w-4 text-blue-500"}),"Email"]})}),(0,t.jsx)(u.Ql,{value:"meeting",className:"text-black hover:bg-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(K.Z,{className:"h-4 w-4 text-purple-500"}),"Meeting"]})}),(0,t.jsx)(u.Ql,{value:"note",className:"text-black hover:bg-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(O.Z,{className:"h-4 w-4 text-gray-500"}),"Note"]})}),(0,t.jsx)(u.Ql,{value:"follow_up",className:"text-black hover:bg-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)($.Z,{className:"h-4 w-4 text-yellow-500"}),"Follow Up"]})})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"subject",className:"text-foreground",children:"Subject *"}),(0,t.jsx)(d.I,{id:"subject",value:L.subject,onChange:e=>U(s=>({...s,subject:e.target.value})),placeholder:"Brief description of activity",required:!0,className:"bg-background text-foreground border-border"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"description",className:"text-foreground",children:"Description"}),(0,t.jsx)(k.g,{id:"description",value:L.description,onChange:e=>U(s=>({...s,description:e.target.value})),rows:3,placeholder:"Detailed notes about the activity, outcome, next steps...",className:"bg-background text-foreground border-border"})]}),(0,t.jsxs)(n.z,{onClick:et,disabled:!L.subject.trim(),className:"w-full",children:[(0,t.jsx)(K.Z,{className:"h-4 w-4 mr-2"}),"Add Activity"]})]})]}),(0,t.jsxs)(l.Zb,{className:"border-border",children:[(0,t.jsx)(l.Ol,{children:(0,t.jsxs)(l.ll,{className:"text-sm flex items-center gap-2 text-foreground",children:[(0,t.jsx)(H.Z,{className:"h-4 w-4"}),"Activity History (",v.length,")"]})}),(0,t.jsx)(l.aY,{children:N?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2",children:"Loading activities..."})]}):0===v.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(K.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{className:"font-medium text-foreground",children:"No activities recorded yet"}),(0,t.jsx)("p",{className:"text-sm",children:"Start by adding an activity above to track your sales interactions."})]}):(0,t.jsx)("div",{className:"space-y-4",children:v.map(e=>(0,t.jsxs)("div",{className:"border-l-4 border-blue-200 pl-4 py-3 bg-muted/30 rounded-r-lg",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[function(e){switch(e){case"call":return(0,t.jsx)(W.Z,{className:"h-4 w-4 text-green-500"});case"email":return(0,t.jsx)(V.Z,{className:"h-4 w-4 text-blue-500"});case"meeting":return(0,t.jsx)(K.Z,{className:"h-4 w-4 text-purple-500"});case"proposal":return(0,t.jsx)(f.Z,{className:"h-4 w-4 text-orange-500"});case"follow_up":return(0,t.jsx)($.Z,{className:"h-4 w-4 text-yellow-500"});default:return(0,t.jsx)(O.Z,{className:"h-4 w-4 text-gray-500"})}}(e.activity_type),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm text-foreground",children:e.subject}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(O.Z,{className:"h-3 w-3"}),e.employee_name,(0,t.jsx)("span",{children:"•"}),(0,t.jsx)(K.Z,{className:"h-3 w-3"}),new Date(e.completed_at||e.created_at).toLocaleString()]})]})]}),(0,t.jsx)(o.C,{variant:"outline",className:"text-xs capitalize",children:e.activity_type.replace("_"," ")})]}),e.description&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-2 pl-6",children:e.description}),e.outcome&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground mt-1 pl-6",children:[(0,t.jsx)("strong",{children:"Outcome:"})," ",e.outcome]}),e.next_action&&(0,t.jsxs)("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1 pl-6",children:[(0,t.jsx)("strong",{children:"Next Action:"})," ",e.next_action]})]},e.id))})})]})]})]})]})}):null}function es(){let{user:e,role:s}=(0,I.a)(),[a,C]=(0,r.useState)({totalProspects:0,totalClients:0,conversionRate:0,totalCommissions:0,pendingCommissions:0,avgSalesCycle:0}),[k,S]=(0,r.useState)([]),[D,F]=(0,r.useState)(!0),[A,Z]=(0,r.useState)(null),[M,z]=(0,r.useState)(!1),[E,O]=(0,r.useState)(!1),[Q,T]=(0,r.useState)("cards"),[V,L]=(0,r.useState)(""),[U,R]=(0,r.useState)(!1),[Y,q]=(0,r.useState)(null),[W,K]=(0,r.useState)(!1),[$,H]=(0,r.useState)(""),[G,J]=(0,r.useState)("created_at"),[X,es]=(0,r.useState)("desc"),[ea,et]=(0,r.useState)("all"),[er,el]=(0,r.useState)("all");(0,r.useEffect)(()=>{en()},[e,E]);let en=async()=>{try{let t=await fetch("/api/sales/stats");if(t.ok){let e=await t.json();C(e.data||a)}let r={};(null==e?void 0:e.email)&&(r["x-user-email"]=e.email);let l="/api/sales/prospects".concat(E?"?view_all=true":""),n=await fetch(l,{headers:r});if(n.ok){var s;let e=await n.json();S(e.data||[]),L(e.user_role||""),R(e.can_view_all||!1),console.log("\uD83D\uDCCA Loaded ".concat((null===(s=e.data)||void 0===s?void 0:s.length)||0," prospects"))}}catch(e){console.error("Error loading sales data:",e)}finally{F(!1)}},eo=e=>{Z(e),z(!0)},ei=e=>{q(e),K(!0)},ec=e=>({new:"bg-blue-500/10 text-blue-700 dark:text-blue-300 border-blue-500/20",contacted:"bg-yellow-500/10 text-yellow-700 dark:text-yellow-300 border-yellow-500/20",qualified:"bg-green-500/10 text-green-700 dark:text-green-300 border-green-500/20",proposal:"bg-purple-500/10 text-purple-700 dark:text-purple-300 border-purple-500/20",negotiation:"bg-orange-500/10 text-orange-700 dark:text-orange-300 border-orange-500/20",converted:"bg-emerald-500/10 text-emerald-700 dark:text-emerald-300 border-emerald-500/20",lost:"bg-red-500/10 text-red-700 dark:text-red-300 border-red-500/20"})[e]||"bg-muted text-muted-foreground border-border",ed=e=>({low:"bg-muted text-muted-foreground border-border",medium:"bg-blue-500/10 text-blue-700 dark:text-blue-300 border-blue-500/20",high:"bg-orange-500/10 text-orange-700 dark:text-orange-300 border-orange-500/20",urgent:"bg-red-500/10 text-red-700 dark:text-red-300 border-red-500/20"})[e]||"bg-muted text-muted-foreground border-border",eu=e=>{G===e?es("asc"===X?"desc":"asc"):(J(e),es("asc"))},em=(0,r.useMemo)(()=>{let e=[...k];if($.trim()){let s=$.toLowerCase().trim();e=e.filter(e=>[e.business_name,e.contact_name,e.contact_email,e.phone,e.formatted_address,e.street_address,e.city,e.state,e.zip_code,e.website,e.notes,e.assigned_salesperson_name,e.business_type].some(e=>e&&e.toString().toLowerCase().includes(s)))}return"all"!==ea&&(e=e.filter(e=>e.status===ea)),"all"!==er&&(e=e.filter(e=>e.priority===er)),G&&e.sort((e,s)=>{let a=e[G],t=s[G];return("estimated_value"===G?(a=Number(a)||0,t=Number(t)||0):"created_at"===G?(a=new Date(a).getTime(),t=new Date(t).getTime()):(a=String(a||"").toLowerCase(),t=String(t||"").toLowerCase()),a<t)?"asc"===X?-1:1:a>t?"asc"===X?1:-1:0}),e},[k,$,ea,er,G,X]),ex=()=>{H(""),et("all"),el("all"),J("created_at"),es("desc")},eh=(0,r.useMemo)(()=>Array.from(new Set(k.map(e=>e.status))).sort(),[k]),eg=(0,r.useMemo)(()=>Array.from(new Set(k.map(e=>e.priority))).sort(),[k]);if(D)return(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-8 bg-muted rounded w-1/4 mb-6"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-32 bg-muted rounded"},s))})]})});let eb=e=>{let{field:s,children:a}=e;return(0,t.jsx)("th",{className:"border border-border px-4 py-2 text-left cursor-pointer hover:bg-muted/50 text-foreground",onClick:()=>eu(s),children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[a,G===s&&("asc"===X?(0,t.jsx)(m.Z,{className:"h-3 w-3"}):(0,t.jsx)(x.Z,{className:"h-3 w-3"}))]})})};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Pipeline"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Manage prospects and track sales performance",E?" (All Prospects)":" (My Prospects)"]})]}),(0,t.jsx)(P,{trigger:(0,t.jsxs)(n.z,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4"}),"New Prospect"]}),onProspectCreated:en})]}),(0,t.jsx)(l.Zb,{children:(0,t.jsx)(l.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[U&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(i.r,{id:"view-all",checked:E,onCheckedChange:O}),(0,t.jsx)(c._,{htmlFor:"view-all",className:"text-foreground",children:"View All Prospects"})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Role: ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:V})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(n.z,{variant:"cards"===Q?"default":"outline",size:"sm",onClick:()=>T("cards"),children:[(0,t.jsx)(b.Z,{className:"h-4 w-4 mr-1"}),"Cards"]}),(0,t.jsxs)(n.z,{variant:"table"===Q?"default":"outline",size:"sm",onClick:()=>T("table"),children:[(0,t.jsx)(v.Z,{className:"h-4 w-4 mr-1"}),"Table"]})]})]})})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(l.ll,{className:"text-sm font-medium",children:"Total Prospects"}),(0,t.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(l.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:k.length}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[em.length!==k.length&&"".concat(em.length," filtered • "),E?"All prospects in system":"Your prospects in pipeline"]})]})]}),(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(l.ll,{className:"text-sm font-medium",children:"Clients"}),(0,t.jsx)(j.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(l.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:a.totalClients}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Converted prospects"})]})]}),(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(l.ll,{className:"text-sm font-medium",children:"Conversion Rate"}),(0,t.jsx)(N.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(l.aY,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[a.conversionRate,"%"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Prospects to clients"})]})]}),(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(l.ll,{className:"text-sm font-medium",children:"Commissions"}),(0,t.jsx)(f.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(l.aY,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:["$",a.pendingCommissions]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Pending commissions"})]})]})]}),(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.ll,{children:"Prospects Pipeline"}),(0,t.jsx)(l.SZ,{children:"Track and manage sales prospects"})]}),0===k.length&&(0,t.jsx)(P,{trigger:(0,t.jsxs)(n.z,{variant:"outline",className:"flex items-center gap-2",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4"}),"Add First Prospect"]}),onProspectCreated:en})]}),k.length>0&&(0,t.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(_.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,t.jsx)(d.I,{placeholder:"Search by business name, contact, address, notes...",value:$,onChange:e=>H(e.target.value),className:"pl-10 pr-10"}),$&&(0,t.jsx)(n.z,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:()=>H(""),children:(0,t.jsx)(y.Z,{className:"h-3 w-3"})})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c._,{className:"text-sm font-medium text-foreground",children:"Sort by:"}),(0,t.jsxs)(u.Ph,{value:G,onValueChange:J,children:[(0,t.jsx)(u.i4,{className:"w-40 bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"business_name",className:"text-black hover:bg-gray-100",children:"Business Name"}),(0,t.jsx)(u.Ql,{value:"contact_name",className:"text-black hover:bg-gray-100",children:"Contact Name"}),(0,t.jsx)(u.Ql,{value:"created_at",className:"text-black hover:bg-gray-100",children:"Created Date"}),(0,t.jsx)(u.Ql,{value:"estimated_value",className:"text-black hover:bg-gray-100",children:"Value"}),(0,t.jsx)(u.Ql,{value:"status",className:"text-black hover:bg-gray-100",children:"Status"}),(0,t.jsx)(u.Ql,{value:"priority",className:"text-black hover:bg-gray-100",children:"Priority"}),(0,t.jsx)(u.Ql,{value:"assigned_salesperson_name",className:"text-black hover:bg-gray-100",children:"Salesperson"})]})]}),(0,t.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>es("asc"===X?"desc":"asc"),children:"asc"===X?(0,t.jsx)(m.Z,{className:"h-4 w-4"}):(0,t.jsx)(x.Z,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c._,{className:"text-sm font-medium text-foreground",children:"Status:"}),(0,t.jsxs)(u.Ph,{value:ea,onValueChange:et,children:[(0,t.jsx)(u.i4,{className:"w-32 bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"all",className:"text-black hover:bg-gray-100",children:"All Status"}),eh.map(e=>(0,t.jsx)(u.Ql,{value:e,className:"text-black hover:bg-gray-100",children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c._,{className:"text-sm font-medium text-foreground",children:"Priority:"}),(0,t.jsxs)(u.Ph,{value:er,onValueChange:el,children:[(0,t.jsx)(u.i4,{className:"w-32 bg-background text-foreground border-border",children:(0,t.jsx)(u.ki,{})}),(0,t.jsxs)(u.Bw,{className:"bg-white border-gray-300",children:[(0,t.jsx)(u.Ql,{value:"all",className:"text-black hover:bg-gray-100",children:"All Priority"}),eg.map(e=>(0,t.jsx)(u.Ql,{value:e,className:"text-black hover:bg-gray-100",children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]})]}),($||"all"!==ea||"all"!==er)&&(0,t.jsxs)(n.z,{variant:"outline",size:"sm",onClick:ex,children:[(0,t.jsx)(y.Z,{className:"h-3 w-3 mr-1"}),"Clear Filters"]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground ml-auto",children:["Showing ",em.length," of ",k.length," prospects"]})]})]})]}),(0,t.jsx)(l.aY,{children:0===k.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(p.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No prospects yet"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"Start building your sales pipeline by adding your first prospect."})]}):0===em.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(w.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No prospects match your filters"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your search or filter criteria."}),(0,t.jsx)(n.z,{variant:"outline",onClick:ex,children:"Clear All Filters"})]}):(0,t.jsx)(t.Fragment,{children:"cards"===Q?(0,t.jsx)("div",{className:"space-y-4",children:em.map(e=>(0,t.jsx)(l.Zb,{className:"hover:bg-muted/30 transition-colors",children:(0,t.jsxs)(l.aY,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-foreground",children:e.business_name}),(0,t.jsx)(o.C,{variant:"outline",className:ec(e.status),children:e.status}),(0,t.jsx)(o.C,{variant:"outline",className:ed(e.priority),children:e.priority})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.contact_name&&(0,t.jsxs)("div",{children:["Contact: ",e.contact_name]}),e.contact_email&&(0,t.jsxs)("div",{children:["Email: ",e.contact_email]}),e.phone&&(0,t.jsxs)("div",{children:["Phone: ",e.phone]}),e.formatted_address&&(0,t.jsxs)("div",{children:["Address: ",e.formatted_address]}),E&&(0,t.jsxs)("div",{className:"font-medium text-primary",children:["Assigned to: ",e.assigned_salesperson_name," (",e.assigned_salesperson_role,")"]})]})]}),(0,t.jsxs)("div",{className:"text-right flex flex-col items-end gap-2",children:[e.estimated_value>0&&(0,t.jsxs)("div",{className:"text-lg font-semibold text-emerald-600 dark:text-emerald-400",children:["$",Number(e.estimated_value).toLocaleString()]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleDateString()]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.z,{size:"sm",variant:"outline",onClick:()=>ei(e),children:[(0,t.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),"Edit"]}),"converted"!==e.status&&"lost"!==e.status&&(0,t.jsx)(n.z,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>eo(e),children:"Convert to Client"})]})]})]}),e.notes&&(0,t.jsx)("div",{className:"mt-3 text-sm text-muted-foreground bg-muted/50 p-2 rounded border",children:e.notes})]})},e.id))}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse border border-border",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-muted/50",children:[(0,t.jsx)(eb,{field:"business_name",children:"Business"}),(0,t.jsx)(eb,{field:"contact_name",children:"Contact"}),(0,t.jsx)(eb,{field:"assigned_salesperson_name",children:"Salesperson"}),(0,t.jsx)(eb,{field:"status",children:"Status"}),(0,t.jsx)(eb,{field:"priority",children:"Priority"}),(0,t.jsx)(eb,{field:"estimated_value",children:"Value"}),(0,t.jsx)(eb,{field:"created_at",children:"Created"}),(0,t.jsx)("th",{className:"border border-border px-4 py-2 text-left text-foreground",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:em.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-muted/30 transition-colors",children:[(0,t.jsxs)("td",{className:"border border-border px-4 py-2",children:[(0,t.jsx)("div",{className:"font-medium text-foreground",children:e.business_name}),e.formatted_address&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:e.formatted_address})]}),(0,t.jsxs)("td",{className:"border border-border px-4 py-2",children:[e.contact_name&&(0,t.jsx)("div",{className:"text-foreground",children:e.contact_name}),e.contact_email&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:e.contact_email})]}),(0,t.jsxs)("td",{className:"border border-border px-4 py-2",children:[(0,t.jsx)("div",{className:"font-medium text-foreground",children:e.assigned_salesperson_name}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:e.assigned_salesperson_role})]}),(0,t.jsx)("td",{className:"border border-border px-4 py-2",children:(0,t.jsx)(o.C,{variant:"outline",className:ec(e.status),children:e.status})}),(0,t.jsx)("td",{className:"border border-border px-4 py-2",children:(0,t.jsx)(o.C,{variant:"outline",className:ed(e.priority),children:e.priority})}),(0,t.jsx)("td",{className:"border border-border px-4 py-2",children:e.estimated_value>0&&(0,t.jsxs)("div",{className:"font-semibold text-emerald-600 dark:text-emerald-400",children:["$",Number(e.estimated_value).toLocaleString()]})}),(0,t.jsx)("td",{className:"border border-border px-4 py-2",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})}),(0,t.jsx)("td",{className:"border border-border px-4 py-2",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.z,{size:"sm",variant:"outline",onClick:()=>ei(e),children:(0,t.jsx)(h.Z,{className:"h-3 w-3"})}),"converted"!==e.status&&"lost"!==e.status&&(0,t.jsx)(n.z,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>eo(e),children:"Convert"})]})})]},e.id))})]})})})})]}),A&&(0,t.jsx)(B,{isOpen:M,onClose:()=>z(!1),prospect:A,onSuccess:()=>{z(!1),Z(null),en()}}),Y&&(0,t.jsx)(ee,{isOpen:W,onClose:()=>K(!1),prospect:Y,onSuccess:()=>{K(!1),q(null),en()},userRole:V})]})}},5800:function(e,s,a){"use strict";a.d(s,{Providers:function(){return x},a:function(){return d}});var t=a(7437),r=a(2265),l=a(3301),n=a(5516),o=a(5922);function i(e){let{children:s,...a}=e;return(0,t.jsx)(o.f,{...a,children:s})}let c=(0,r.createContext)({user:null,role:null,businessId:null,loading:!0,isFirebaseConfigured:!1}),d=()=>(0,r.useContext)(c);function u(e){if(console.log("\uD83D\uDD0D Determining role for email:",e),!e)return console.log("❌ No email provided, defaulting to client"),"client";let s=e.toLowerCase();return"miguel.giraldo@gladgrade.com"===s?(console.log("\uD83D\uDC51 Super Admin detected!"),"super_admin"):s.endsWith("@gladgrade.com")?(console.log("\uD83C\uDFE2 GladGrade employee detected"),s.includes("admin"))?(console.log("\uD83D\uDEE1️ Admin role assigned"),"admin"):s.includes("moderator")||s.includes("mod")?(console.log("\uD83D\uDD0D Moderator role assigned"),"moderator"):s.includes("support")||s.includes("employee")?(console.log("\uD83D\uDC64 Employee role assigned"),"employee"):(console.log("\uD83D\uDEE1️ Default admin role for GladGrade employee"),"admin"):(console.log("\uD83C\uDFEA Client role assigned"),"client")}function m(e){let{children:s}=e,[a,o]=(0,r.useState)(null),[i,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[h,g]=(0,r.useState)(!0),[b,v]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(console.log("\uD83D\uDE80 AuthProvider useEffect running..."),console.log("\uD83D\uDD27 Firebase configured:",!0),v(!0),n.I8){console.log("\uD83D\uDD10 Setting up Firebase auth listener...");let e=(0,l.Aj)(n.I8,async e=>{if(console.log("\uD83D\uDD04 Auth state changed:",e?"User: ".concat(e.email):"No user"),o(e),e&&e.email)try{console.log("\uD83C\uDFAF Getting user role...");let s=await e.getIdTokenResult(),a=s.claims.role,t=null;console.log("\uD83C\uDFF7️ Custom claim role:",a),"client"===a&&s.claims.businessId&&(t=parseInt(s.claims.businessId),console.log("\uD83C\uDFE2 Client businessId extracted:",t)),a||(a=u(e.email),console.log("\uD83D\uDD10 Role assigned based on email domain: ".concat(e.email," → ").concat(a))),d(a),x(t),console.log("✅ Final role set:",a),console.log("✅ Final businessId set:",t)}catch(a){console.error("❌ Error getting user role:",a);let s=u(e.email);d(s),x(null),console.log("\uD83D\uDD04 Fallback role assigned: ".concat(e.email," → ").concat(s))}else console.log("\uD83D\uDC64 No user, setting role and businessId to null"),d(null),x(null);console.log("⏰ Setting loading to false"),g(!1)});return()=>{console.log("\uD83E\uDDF9 Cleaning up auth listener"),e()}}console.log("❌ Firebase not configured or auth not available"),g(!1)},[]),(0,t.jsx)(c.Provider,{value:{user:a,role:i,businessId:m,loading:h,isFirebaseConfigured:b},children:s})}function x(e){let{children:s}=e;return(0,t.jsx)(i,{attribute:"class",defaultTheme:"light",enableSystem:!0,disableTransitionOnChange:!1,children:(0,t.jsx)(m,{children:s})})}},6818:function(e,s,a){"use strict";a.d(s,{g:function(){return n}});var t=a(7437),r=a(2265),l=a(4508);let n=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...r})});n.displayName="Textarea"},5516:function(e,s,a){"use strict";a.d(s,{I8:function(){return d}});var t=a(738),r=a(3301),l=a(5978),n=a(62);console.log("Firebase Config Debug:",{apiKey:"✓ Set",authDomain:"✓ Set",projectId:"✓ Set",storageBucket:"✓ Set",messagingSenderId:"✓ Set",appId:"✓ Set"});let o={apiKey:"AIzaSyDD3_U64MVrZp2iNxYWVX9_hHytC9x_WVo",authDomain:"reactgladgrade.firebaseapp.com",projectId:"reactgladgrade",storageBucket:"reactgladgrade.appspot.com",messagingSenderId:"360532994710",appId:"1:360532994710:web:7376b3b3bab542567bf0b7",measurementId:"G-G7Y7B5CME3"},i=["apiKey","authDomain","projectId","appId"].filter(e=>!o[e]);if(i.length>0)throw console.error("Missing Firebase configuration fields:",i),console.error("Current config:",o),console.error("Make sure your .env.local file is in the root directory and restart the dev server"),Error("Missing Firebase configuration: ".concat(i.join(", ")));let c=null,d=null;try{c=(0,t.ZF)(o),d=(0,r.v0)(c),(0,l.ad)(c),(0,n.cF)(c),console.log("✅ Firebase initialized successfully")}catch(e){throw console.error("❌ Firebase initialization failed:",e),e}}},function(e){e.O(0,[139,4358,6137,1709,3301,3774,7005,1153,600,4266,7033,4048,3571,1626,2971,2117,1744],function(){return e(e.s=7427)}),_N_E=e.O()}]);